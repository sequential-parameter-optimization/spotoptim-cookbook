<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bartz-Beielstein, Thomas">
<meta name="dcterms.date" content="2025-11-19">

<title>11&nbsp; SpotOptim Step-by-Step Optimization Process – Sequential Parameter Optimization Cookbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./spotoptim_examples.html" rel="next">
<link href="./006_infill.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-58b8d76c6f3e5a567bac4a37e40b55a6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="twitter:title" content="11&nbsp; SpotOptim Step-by-Step Optimization Process – Sequential Parameter Optimization Cookbook">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="spot_step_by_step_files/figure-html/cell-9-output-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./spot_step_by_step.html">Sequential Parameter Optimization Toolbox (SPOT)</a></li><li class="breadcrumb-item"><a href="./spot_step_by_step.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">SpotOptim Step-by-Step Optimization Process</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Sequential Parameter Optimization Cookbook</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/sequential-parameter-optimization/spotpython" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Sequential-Parameter-Optimization-Cookbook.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Optimization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002_awwe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Aircraft Wing Weight Example</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001_surrogate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simulation and Surrogate Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001_sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sampling Plans</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_constructing_surrogate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Constructing a Surrogate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005_num_rsm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Response Surface Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_num_poly.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Polynomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_num_rbf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Radial Basis Function Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_num_gp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Kriging (Gaussian Process Regression)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Matrices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006_infill.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Infill Criteria</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Sequential Parameter Optimization Toolbox (SPOT)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spot_step_by_step.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">SpotOptim Step-by-Step Optimization Process</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spotoptim_examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">SpotOptim Internal Methods Examples</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./019_spotoptim_sk_matern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Benchmarking SpotOptim with Sklearn Kriging (Matern Kernel) on 6D Rosenbrock and 10D Michalewicz Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kriging_surrogate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Kriging Surrogate Models in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Reproducibility in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./awwe_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Optimizing the Aircraft Wing Weight Example</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./surrogate_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Surrogate Model Selection in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pinns_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Physics-Informed Neural Networks (PINNs) Demo 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pinns_2_hyperparameter_tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Hyperparameter Tuning for Physics-Informed Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acquisition_failure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Acquisition Failure Handling in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diabetes_dataset.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Diabetes Dataset Utilities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./factor_variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Factor Variables for Categorical Hyperparameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Variable Transformations for Search Space Scaling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kriging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Kriging Surrogate Integration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learning_rate_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Learning Rate Mapping for Unified Optimizer Interface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unified_learning_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Unified Learning Rate Interface in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiobjective.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Multi-Objective Optimization Support in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./plot_surrogate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Surrogate Model Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./point_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Point Selection Implementation in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./save_load.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Save and Load in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./success_rate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Success Rate Tracking in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tensorboard_clean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">TensorBoard Log Cleaning Feature in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tensorboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">TensorBoard Logging in SpotOptim</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./var_type.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Variable Type (var_type) Implementation in SpotOptim</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">12</span> Introduction</a></li>
  <li><a href="#setup-and-test-functions" id="toc-setup-and-test-functions" class="nav-link" data-scroll-target="#setup-and-test-functions"><span class="header-section-number">13</span> Setup and Test Functions</a></li>
  <li><a href="#standard-optimization-workflow" id="toc-standard-optimization-workflow" class="nav-link" data-scroll-target="#standard-optimization-workflow"><span class="header-section-number">14</span> Standard Optimization Workflow</a>
  <ul class="collapse">
  <li><a href="#phase-initialization-and-setup" id="toc-phase-initialization-and-setup" class="nav-link" data-scroll-target="#phase-initialization-and-setup"><span class="header-section-number">14.1</span> Phase: Initialization and Setup</a></li>
  <li><a href="#phase-initial-design-generation" id="toc-phase-initial-design-generation" class="nav-link" data-scroll-target="#phase-initial-design-generation"><span class="header-section-number">14.2</span> Phase: Initial Design Generation</a>
  <ul class="collapse">
  <li><a href="#method-get_initial_design" id="toc-method-get_initial_design" class="nav-link" data-scroll-target="#method-get_initial_design"><span class="header-section-number">14.2.1</span> Method: <code>get_initial_design()</code></a></li>
  </ul></li>
  <li><a href="#phase-3-initial-design-curation" id="toc-phase-3-initial-design-curation" class="nav-link" data-scroll-target="#phase-3-initial-design-curation"><span class="header-section-number">14.3</span> Phase 3: Initial Design Curation</a>
  <ul class="collapse">
  <li><a href="#method-_curate_initial_design" id="toc-method-_curate_initial_design" class="nav-link" data-scroll-target="#method-_curate_initial_design"><span class="header-section-number">14.3.1</span> Method: <code>_curate_initial_design()</code></a></li>
  </ul></li>
  <li><a href="#phase-4-initial-design-evaluation" id="toc-phase-4-initial-design-evaluation" class="nav-link" data-scroll-target="#phase-4-initial-design-evaluation"><span class="header-section-number">14.4</span> Phase 4: Initial Design Evaluation</a>
  <ul class="collapse">
  <li><a href="#method-_evaluate_function" id="toc-method-_evaluate_function" class="nav-link" data-scroll-target="#method-_evaluate_function"><span class="header-section-number">14.4.1</span> Method: <code>_evaluate_function()</code></a></li>
  </ul></li>
  <li><a href="#phase-5-handling-failed-evaluations" id="toc-phase-5-handling-failed-evaluations" class="nav-link" data-scroll-target="#phase-5-handling-failed-evaluations"><span class="header-section-number">14.5</span> Phase 5: Handling Failed Evaluations</a>
  <ul class="collapse">
  <li><a href="#method-_handle_na_initial_designx0y0" id="toc-method-_handle_na_initial_designx0y0" class="nav-link" data-scroll-target="#method-_handle_na_initial_designx0y0"><span class="header-section-number">14.5.1</span> Method: <code>_handle_NA_initial_design(X0,y0)</code></a></li>
  </ul></li>
  <li><a href="#phase-6-validation-check" id="toc-phase-6-validation-check" class="nav-link" data-scroll-target="#phase-6-validation-check"><span class="header-section-number">14.6</span> Phase 6: Validation Check</a>
  <ul class="collapse">
  <li><a href="#method-_check_size_initial_designy0-n_evaluated" id="toc-method-_check_size_initial_designy0-n_evaluated" class="nav-link" data-scroll-target="#method-_check_size_initial_designy0-n_evaluated"><span class="header-section-number">14.6.1</span> Method: <code>_check_size_initial_design(y0, n_evaluated)</code></a></li>
  </ul></li>
  <li><a href="#phase-7-storage-initialization" id="toc-phase-7-storage-initialization" class="nav-link" data-scroll-target="#phase-7-storage-initialization"><span class="header-section-number">14.7</span> Phase 7: Storage Initialization</a>
  <ul class="collapse">
  <li><a href="#method-_init_storage" id="toc-method-_init_storage" class="nav-link" data-scroll-target="#method-_init_storage"><span class="header-section-number">14.7.1</span> Method: <code>_init_storage()</code></a></li>
  </ul></li>
  <li><a href="#phase-statistics-update" id="toc-phase-statistics-update" class="nav-link" data-scroll-target="#phase-statistics-update"><span class="header-section-number">14.8</span> Phase: Statistics Update</a>
  <ul class="collapse">
  <li><a href="#method-update_stats" id="toc-method-update_stats" class="nav-link" data-scroll-target="#method-update_stats"><span class="header-section-number">14.8.1</span> Method: <code>update_stats()</code></a></li>
  </ul></li>
  <li><a href="#phase-log-initial-design-to-tensorboard" id="toc-phase-log-initial-design-to-tensorboard" class="nav-link" data-scroll-target="#phase-log-initial-design-to-tensorboard"><span class="header-section-number">14.9</span> Phase: Log initial Design to TensorBoard</a>
  <ul class="collapse">
  <li><a href="#method-_log_initial_design_tensorboard" id="toc-method-_log_initial_design_tensorboard" class="nav-link" data-scroll-target="#method-_log_initial_design_tensorboard"><span class="header-section-number">14.9.1</span> Method: <code>_log_initial_design_tensorboard()</code></a></li>
  </ul></li>
  <li><a href="#phase-initial-best-point" id="toc-phase-initial-best-point" class="nav-link" data-scroll-target="#phase-initial-best-point"><span class="header-section-number">14.10</span> Phase: Initial Best Point</a>
  <ul class="collapse">
  <li><a href="#method-_get_best_xy_initial_design" id="toc-method-_get_best_xy_initial_design" class="nav-link" data-scroll-target="#method-_get_best_xy_initial_design"><span class="header-section-number">14.10.1</span> Method: <code>_get_best_xy_initial_design()</code></a></li>
  </ul></li>
  <li><a href="#illustration-of-the-initial-design-phase-results" id="toc-illustration-of-the-initial-design-phase-results" class="nav-link" data-scroll-target="#illustration-of-the-initial-design-phase-results"><span class="header-section-number">14.11</span> Illustration of the Initial Design Phase Results</a></li>
  </ul></li>
  <li><a href="#sequential-optimization-loop" id="toc-sequential-optimization-loop" class="nav-link" data-scroll-target="#sequential-optimization-loop"><span class="header-section-number">15</span> Sequential Optimization Loop</a>
  <ul class="collapse">
  <li><a href="#step-surrogate-model-fitting" id="toc-step-surrogate-model-fitting" class="nav-link" data-scroll-target="#step-surrogate-model-fitting"><span class="header-section-number">15.1</span> Step: Surrogate Model Fitting</a>
  <ul class="collapse">
  <li><a href="#method-_fit_scheduler" id="toc-method-_fit_scheduler" class="nav-link" data-scroll-target="#method-_fit_scheduler"><span class="header-section-number">15.1.1</span> Method: <code>_fit_scheduler()</code></a></li>
  <li><a href="#method-_fit_surrogate" id="toc-method-_fit_surrogate" class="nav-link" data-scroll-target="#method-_fit_surrogate"><span class="header-section-number">15.1.2</span> Method: <code>_fit_surrogate()</code></a></li>
  <li><a href="#method-_selection_dispatcher" id="toc-method-_selection_dispatcher" class="nav-link" data-scroll-target="#method-_selection_dispatcher"><span class="header-section-number">15.1.3</span> Method: <code>_selection_dispatcher()</code></a></li>
  <li><a href="#step-apply-ocba" id="toc-step-apply-ocba" class="nav-link" data-scroll-target="#step-apply-ocba"><span class="header-section-number">15.1.4</span> Step: Apply OCBA</a></li>
  <li><a href="#method-_apply_ocba" id="toc-method-_apply_ocba" class="nav-link" data-scroll-target="#method-_apply_ocba"><span class="header-section-number">15.1.5</span> Method: <code>_apply_ocba()</code></a></li>
  </ul></li>
  <li><a href="#step-predict-with-uncertainty" id="toc-step-predict-with-uncertainty" class="nav-link" data-scroll-target="#step-predict-with-uncertainty"><span class="header-section-number">15.2</span> Step: Predict with Uncertainty</a>
  <ul class="collapse">
  <li><a href="#method-_predict_with_uncertainty" id="toc-method-_predict_with_uncertainty" class="nav-link" data-scroll-target="#method-_predict_with_uncertainty"><span class="header-section-number">15.2.1</span> Method: <code>_predict_with_uncertainty()</code></a></li>
  </ul></li>
  <li><a href="#step-next-point-suggestion" id="toc-step-next-point-suggestion" class="nav-link" data-scroll-target="#step-next-point-suggestion"><span class="header-section-number">15.3</span> Step: Next Point Suggestion</a>
  <ul class="collapse">
  <li><a href="#method-_suggest_next_point" id="toc-method-_suggest_next_point" class="nav-link" data-scroll-target="#method-_suggest_next_point"><span class="header-section-number">15.3.1</span> Method: <code>_suggest_next_point()</code></a></li>
  </ul></li>
  <li><a href="#step-acquisition-function-evaluation" id="toc-step-acquisition-function-evaluation" class="nav-link" data-scroll-target="#step-acquisition-function-evaluation"><span class="header-section-number">15.4</span> Step: Acquisition Function Evaluation</a>
  <ul class="collapse">
  <li><a href="#method-_acquisition_function" id="toc-method-_acquisition_function" class="nav-link" data-scroll-target="#method-_acquisition_function"><span class="header-section-number">15.4.1</span> Method: <code>_acquisition_function()</code></a></li>
  </ul></li>
  <li><a href="#step-update-repeats-for-infill-points" id="toc-step-update-repeats-for-infill-points" class="nav-link" data-scroll-target="#step-update-repeats-for-infill-points"><span class="header-section-number">15.5</span> Step: Update Repeats for Infill Points</a>
  <ul class="collapse">
  <li><a href="#method-_update_repeats_infill_points" id="toc-method-_update_repeats_infill_points" class="nav-link" data-scroll-target="#method-_update_repeats_infill_points"><span class="header-section-number">15.5.1</span> Method: <code>_update_repeats_infill_points()</code></a></li>
  </ul></li>
  <li><a href="#append-ocba-points-to-infill-points" id="toc-append-ocba-points-to-infill-points" class="nav-link" data-scroll-target="#append-ocba-points-to-infill-points"><span class="header-section-number">15.6</span> Append OCBA Points to Infill Points</a></li>
  <li><a href="#step-evaluation-of-new-points" id="toc-step-evaluation-of-new-points" class="nav-link" data-scroll-target="#step-evaluation-of-new-points"><span class="header-section-number">15.7</span> Step: Evaluation of New Points</a>
  <ul class="collapse">
  <li><a href="#method-_evaluate_function-again" id="toc-method-_evaluate_function-again" class="nav-link" data-scroll-target="#method-_evaluate_function-again"><span class="header-section-number">15.7.1</span> Method: <code>_evaluate_function()</code> (again)</a></li>
  </ul></li>
  <li><a href="#step-handle-failed-evaluations-sequential" id="toc-step-handle-failed-evaluations-sequential" class="nav-link" data-scroll-target="#step-handle-failed-evaluations-sequential"><span class="header-section-number">15.8</span> Step: Handle Failed Evaluations (Sequential)</a>
  <ul class="collapse">
  <li><a href="#method-_handle_na_new_points" id="toc-method-_handle_na_new_points" class="nav-link" data-scroll-target="#method-_handle_na_new_points"><span class="header-section-number">15.8.1</span> Method: <code>_handle_NA_new_points()</code></a></li>
  </ul></li>
  <li><a href="#step-update-success-rate" id="toc-step-update-success-rate" class="nav-link" data-scroll-target="#step-update-success-rate"><span class="header-section-number">15.9</span> Step: Update Success Rate</a>
  <ul class="collapse">
  <li><a href="#method-_update_success_ratey0" id="toc-method-_update_success_ratey0" class="nav-link" data-scroll-target="#method-_update_success_ratey0"><span class="header-section-number">15.9.1</span> Method: <code>_update_success_rate(y0)</code></a></li>
  </ul></li>
  <li><a href="#step-update-storage" id="toc-step-update-storage" class="nav-link" data-scroll-target="#step-update-storage"><span class="header-section-number">15.10</span> Step: Update Storage</a>
  <ul class="collapse">
  <li><a href="#internal-updates" id="toc-internal-updates" class="nav-link" data-scroll-target="#internal-updates"><span class="header-section-number">15.10.1</span> Internal updates</a></li>
  </ul></li>
  <li><a href="#update-statistics" id="toc-update-statistics" class="nav-link" data-scroll-target="#update-statistics"><span class="header-section-number">15.11</span> Update Statistics</a>
  <ul class="collapse">
  <li><a href="#what-happens-in-update_stats" id="toc-what-happens-in-update_stats" class="nav-link" data-scroll-target="#what-happens-in-update_stats"><span class="header-section-number">15.11.1</span> What happens in <code>update_stats()</code>:</a></li>
  </ul></li>
  <li><a href="#step-update-best-solution" id="toc-step-update-best-solution" class="nav-link" data-scroll-target="#step-update-best-solution"><span class="header-section-number">15.12</span> Step: Update Best Solution</a>
  <ul class="collapse">
  <li><a href="#method-_update_best_main_loop" id="toc-method-_update_best_main_loop" class="nav-link" data-scroll-target="#method-_update_best_main_loop"><span class="header-section-number">15.12.1</span> Method: <code>_update_best_main_loop()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#complete-optimization-example" id="toc-complete-optimization-example" class="nav-link" data-scroll-target="#complete-optimization-example"><span class="header-section-number">16</span> Complete Optimization Example</a></li>
  <li><a href="#noisy-functions-with-repeats" id="toc-noisy-functions-with-repeats" class="nav-link" data-scroll-target="#noisy-functions-with-repeats"><span class="header-section-number">17</span> Noisy Functions with Repeats</a>
  <ul class="collapse">
  <li><a href="#configuration-for-noisy-functions" id="toc-configuration-for-noisy-functions" class="nav-link" data-scroll-target="#configuration-for-noisy-functions"><span class="header-section-number">17.1</span> Configuration for Noisy Functions</a></li>
  <li><a href="#noisy-optimization-workflow-differences" id="toc-noisy-optimization-workflow-differences" class="nav-link" data-scroll-target="#noisy-optimization-workflow-differences"><span class="header-section-number">17.2</span> Noisy Optimization Workflow Differences</a>
  <ul class="collapse">
  <li><a href="#modified-initial-design" id="toc-modified-initial-design" class="nav-link" data-scroll-target="#modified-initial-design"><span class="header-section-number">17.2.1</span> Modified Initial Design</a></li>
  <li><a href="#update-statistics-method" id="toc-update-statistics-method" class="nav-link" data-scroll-target="#update-statistics-method"><span class="header-section-number">17.2.2</span> Update Statistics Method</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#optimal-computing-budget-allocation-ocba" id="toc-optimal-computing-budget-allocation-ocba" class="nav-link" data-scroll-target="#optimal-computing-budget-allocation-ocba"><span class="header-section-number">18</span> Optimal Computing Budget Allocation (OCBA)</a>
  <ul class="collapse">
  <li><a href="#ocba-configuration" id="toc-ocba-configuration" class="nav-link" data-scroll-target="#ocba-configuration"><span class="header-section-number">18.1</span> OCBA Configuration</a></li>
  <li><a href="#ocba-method" id="toc-ocba-method" class="nav-link" data-scroll-target="#ocba-method"><span class="header-section-number">18.2</span> OCBA Method</a>
  <ul class="collapse">
  <li><a href="#method-_apply_ocba-1" id="toc-method-_apply_ocba-1" class="nav-link" data-scroll-target="#method-_apply_ocba-1"><span class="header-section-number">18.2.1</span> Method: <code>_apply_ocba()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#handling-function-evaluation-failures" id="toc-handling-function-evaluation-failures" class="nav-link" data-scroll-target="#handling-function-evaluation-failures"><span class="header-section-number">19</span> Handling Function Evaluation Failures</a>
  <ul class="collapse">
  <li><a href="#example-with-failures" id="toc-example-with-failures" class="nav-link" data-scroll-target="#example-with-failures"><span class="header-section-number">19.1</span> Example with Failures</a></li>
  <li><a href="#failure-handling-in-initial-design" id="toc-failure-handling-in-initial-design" class="nav-link" data-scroll-target="#failure-handling-in-initial-design"><span class="header-section-number">19.2</span> Failure Handling in Initial Design</a>
  <ul class="collapse">
  <li><a href="#method-_handle_na_initial_design" id="toc-method-_handle_na_initial_design" class="nav-link" data-scroll-target="#method-_handle_na_initial_design"><span class="header-section-number">19.2.1</span> Method: <code>_handle_NA_initial_design()</code></a></li>
  </ul></li>
  <li><a href="#failure-handling-in-sequential-phase" id="toc-failure-handling-in-sequential-phase" class="nav-link" data-scroll-target="#failure-handling-in-sequential-phase"><span class="header-section-number">19.3</span> Failure Handling in Sequential Phase</a>
  <ul class="collapse">
  <li><a href="#method-_handle_na_new_points-1" id="toc-method-_handle_na_new_points-1" class="nav-link" data-scroll-target="#method-_handle_na_new_points-1"><span class="header-section-number">19.3.1</span> Method: <code>_handle_NA_new_points()</code></a></li>
  </ul></li>
  <li><a href="#penalty-application" id="toc-penalty-application" class="nav-link" data-scroll-target="#penalty-application"><span class="header-section-number">19.4</span> Penalty Application</a>
  <ul class="collapse">
  <li><a href="#method-_apply_penalty_na" id="toc-method-_apply_penalty_na" class="nav-link" data-scroll-target="#method-_apply_penalty_na"><span class="header-section-number">19.4.1</span> Method: <code>_apply_penalty_NA()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#complete-method-summary" id="toc-complete-method-summary" class="nav-link" data-scroll-target="#complete-method-summary"><span class="header-section-number">20</span> Complete Method Summary</a>
  <ul class="collapse">
  <li><a href="#methods-called-during-optimize" id="toc-methods-called-during-optimize" class="nav-link" data-scroll-target="#methods-called-during-optimize"><span class="header-section-number">20.1</span> Methods Called During <code>optimize()</code></a>
  <ul class="collapse">
  <li><a href="#preparation-phase" id="toc-preparation-phase" class="nav-link" data-scroll-target="#preparation-phase"><span class="header-section-number">20.1.1</span> Preparation Phase</a></li>
  <li><a href="#sequential-optimization-loop-each-iteration" id="toc-sequential-optimization-loop-each-iteration" class="nav-link" data-scroll-target="#sequential-optimization-loop-each-iteration"><span class="header-section-number">20.1.2</span> Sequential Optimization Loop (each iteration)</a></li>
  <li><a href="#finalization" id="toc-finalization" class="nav-link" data-scroll-target="#finalization"><span class="header-section-number">20.1.3</span> Finalization</a></li>
  </ul></li>
  <li><a href="#helper-methods-used" id="toc-helper-methods-used" class="nav-link" data-scroll-target="#helper-methods-used"><span class="header-section-number">20.2</span> Helper Methods Used</a></li>
  </ul></li>
  <li><a href="#termination-conditions" id="toc-termination-conditions" class="nav-link" data-scroll-target="#termination-conditions"><span class="header-section-number">21</span> Termination Conditions</a>
  <ul class="collapse">
  <li><a href="#method-_determine_termination" id="toc-method-_determine_termination" class="nav-link" data-scroll-target="#method-_determine_termination"><span class="header-section-number">21.1</span> Method: <code>_determine_termination()</code></a></li>
  </ul></li>
  <li><a href="#performance-comparison-on-noisy-functions" id="toc-performance-comparison-on-noisy-functions" class="nav-link" data-scroll-target="#performance-comparison-on-noisy-functions"><span class="header-section-number">22</span> Performance Comparison on Noisy Functions</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">23</span> Summary</a>
  <ul class="collapse">
  <li><a href="#complete-workflow-diagram" id="toc-complete-workflow-diagram" class="nav-link" data-scroll-target="#complete-workflow-diagram"><span class="header-section-number">23.1</span> Complete Workflow Diagram</a></li>
  <li><a href="#key-concepts" id="toc-key-concepts" class="nav-link" data-scroll-target="#key-concepts"><span class="header-section-number">23.2</span> Key Concepts</a>
  <ul class="collapse">
  <li><a href="#initial-design" id="toc-initial-design" class="nav-link" data-scroll-target="#initial-design"><span class="header-section-number">23.2.1</span> 1. Initial Design</a></li>
  <li><a href="#surrogate-model" id="toc-surrogate-model" class="nav-link" data-scroll-target="#surrogate-model"><span class="header-section-number">23.2.2</span> 2. Surrogate Model</a></li>
  <li><a href="#acquisition-function" id="toc-acquisition-function" class="nav-link" data-scroll-target="#acquisition-function"><span class="header-section-number">23.2.3</span> 3. Acquisition Function</a></li>
  <li><a href="#noise-handling" id="toc-noise-handling" class="nav-link" data-scroll-target="#noise-handling"><span class="header-section-number">23.2.4</span> 4. Noise Handling</a></li>
  <li><a href="#failure-handling" id="toc-failure-handling" class="nav-link" data-scroll-target="#failure-handling"><span class="header-section-number">23.2.5</span> 5. Failure Handling</a></li>
  </ul></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices"><span class="header-section-number">23.3</span> Best Practices</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">23.4</span> Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./spot_step_by_step.html">Sequential Parameter Optimization Toolbox (SPOT)</a></li><li class="breadcrumb-item"><a href="./spot_step_by_step.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">SpotOptim Step-by-Step Optimization Process</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">SpotOptim Step-by-Step Optimization Process</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bartz-Beielstein, Thomas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 19, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Introduction</h1>
<p>This document provides a comprehensive step-by-step explanation of the optimization process in the <code>SpotOptim</code> class. We’ll use the 2-dimensional Rosenbrock function as our example and cover all methods involved in each stage of optimization.</p>
<p><strong>Topics Covered:</strong></p>
<ul>
<li>Standard optimization workflow</li>
<li>Handling noisy functions with repeats</li>
<li>Handling function evaluation failures (NaN/inf values)</li>
</ul>
</section>
<section id="setup-and-test-functions" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Setup and Test Functions</h1>
<p>Let’s start by defining our test functions, including variants with noise and occasional failures. The two-dimensional Rosenbrock function is defined as: <span class="math display">\[
f(x, y) = (a - x)^2 + b(y - x^2)^2
\]</span> where typically (a = 1) and (b = 100). The generalized form for n dimensions is: <span class="math display">\[
f(X) = \sum_{i=1}^{N-1} \left[100 \cdot (x_{i+1} - x_i^2)^2 + (1 - x_i)^2\right]
\]</span> The documentation can be found here: <a href="https://sequential-parameter-optimization.github.io/spotoptim/reference/spotoptim/function/analytical/#spotoptim.function.analytical.rosenbrock">DOC</a></p>
<div id="6b7e52b1" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotoptim <span class="im">import</span> SpotOptim</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotoptim.function <span class="im">import</span> rosenbrock</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Set random seed for reproducibility:</p>
<div id="f2b06ff2" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Based on the standard Rosenbrock function, we define two variants:</p>
<ol type="1">
<li>the noisy Rosenbrock function:</li>
</ol>
<div id="09c24b89" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rosenbrock_noisy(X, noise_std<span class="op">=</span><span class="fl">0.1</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Rosenbrock with Gaussian noise for testing noisy optimization.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.atleast_2d(X)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    base_values <span class="op">=</span> rosenbrock(X)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    noise <span class="op">=</span> np.random.normal(<span class="dv">0</span>, noise_std, size<span class="op">=</span>base_values.shape)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> base_values <span class="op">+</span> noise</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>and 2. the Rosenbrock function with occasional failures:</p>
<div id="13fe1d0f" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rosenbrock_with_failures(X, failure_prob<span class="op">=</span><span class="fl">0.15</span>):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Rosenbrock that occasionally returns NaN to simulate evaluation failures.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.atleast_2d(X)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> rosenbrock(X)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomly inject failures</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(values)):</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.random.random() <span class="op">&lt;</span> failure_prob:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            values[i] <span class="op">=</span> np.nan</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="standard-optimization-workflow" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Standard Optimization Workflow</h1>
<p>Let’s trace through a complete optimization run to understand each step.</p>
<section id="phase-initialization-and-setup" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="phase-initialization-and-setup"><span class="header-section-number">14.1</span> Phase: Initialization and Setup</h2>
<p>When you create a <code>SpotOptim</code> instance, several initialization steps occur during the <code>__init__()</code> method, see <a href="https://sequential-parameter-optimization.github.io/spotoptim/reference/spotoptim/SpotOptim/#spotoptim.SpotOptim.SpotOptim">DOC</a>.</p>
<ol type="1">
<li>Objective function (<code>fun</code>) and bounds are stored.</li>
<li>Acquisition function (<code>acquisition</code>) is stored (default is <code>y</code>).</li>
<li>Determine if noise handling is active (based on <code>repeats_initial</code> and <code>repeats_surrogate</code>)</li>
<li>For dimensions with tuple bounds (factor variables), internal integer mappings are created and bounds are replaced with (0, n_levels-1). This is handled by <code>_process_factor_bounds()</code>. So, e.g., <code>[('red', 'green', 'blue')]</code> is mapped to the integer interval <code>[(0, 2)]</code> internally.</li>
<li>The dimension of the problem (<code>n_dim</code>) is inferred from the bounds.</li>
<li>If <code>var_type</code> is not provided, it defaults to all “float” (continuous) variables, except for factor variables which are set to “factor” via <code>_process_factor_bounds()</code>.</li>
<li>Default variable names (<code>var_name</code>) are set if not provided.</li>
<li>Default variable transformations (<code>var_transform</code>) are set if not provided.</li>
<li>Transformations are applied to bounds based on <code>var_transform</code> settings. Natural bounds are stored in <code>_original_lower</code> and <code>_original_upper</code>.</li>
<li>Dimension reduction by identifying fixed dimensions (if any) is performed via <code>_setup_dimension_reduction()</code>.</li>
<li>The surrogate is initialized (default: Gaussian Process with Matérn kernel) as follows:</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>kernel <span class="op">=</span> ConstantKernel(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    constant_value<span class="op">=</span><span class="fl">1.0</span>, constant_value_bounds<span class="op">=</span>(<span class="fl">1e-3</span>, <span class="fl">1e3</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> Matern(length_scale<span class="op">=</span><span class="fl">1.0</span>, length_scale_bounds<span class="op">=</span>(<span class="fl">1e-2</span>, <span class="fl">1e2</span>), nu<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">self</span>.surrogate <span class="op">=</span> GaussianProcessRegressor(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    kernel<span class="op">=</span>kernel,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    n_restarts_optimizer<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    normalize_y<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="va">self</span>.seed,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="12" type="1">
<li>The Design generator is initialized (default: Latin Hypercube Sampling).</li>
<li>The storage for results ins initialized. This includes the following attributes:
<ul>
<li><code>X_</code>: Evaluated design points</li>
<li><code>y_</code>: Corresponding function values</li>
<li><code>y_mo</code>: For multi-objective functions, stores all objectives</li>
<li><code>best_x_</code>: Best point found so far</li>
<li><code>best_y_</code>: Best function value found so far</li>
<li><code>n_iter_</code>: Number of iterations completed</li>
<li><code>mean_X</code>, <code>mean_y</code>, <code>var_y</code>: For noisy functions, mean and variance tracking</li>
<li><code>min_mean_X</code>: Best mean point for noisy functions</li>
<li><code>min_mean_y</code>: Best mean value for noisy functions</li>
<li><code>min_var_y</code>: Variance at best mean point</li>
<li><code>min_X</code>: Best point found (deterministic)</li>
<li><code>min_y</code>: Best function value found (deterministic)</li>
<li><code>counter</code>: Total number of function evaluations</li>
<li><code>success_rate</code>: Ratio of successful evaluations</li>
<li><code>success_counter</code>: Count of successful evaluations</li>
<li><code>window_size</code>: For moving average of success rate</li>
<li><code>success_history</code>: History of success/failure for evaluations</li>
</ul></li>
</ol>
<div id="b4fc042b" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create optimizer</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> SpotOptim(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">2</span>)],</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    var_trans<span class="op">=</span>[<span class="st">"id"</span>, <span class="st">"log"</span>]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>TensorBoard logging disabled</code></pre>
</div>
</div>
</section>
<section id="phase-initial-design-generation" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="phase-initial-design-generation"><span class="header-section-number">14.2</span> Phase: Initial Design Generation</h2>
<section id="method-get_initial_design" class="level3" data-number="14.2.1">
<h3 data-number="14.2.1" class="anchored" data-anchor-id="method-get_initial_design"><span class="header-section-number">14.2.1</span> Method: <code>get_initial_design()</code></h3>
<p>This method generates or processes the initial sample points. It is manually called here for demonstration (normally done inside <code>optimize()</code>).</p>
<p><strong>What happens in <code>get_initial_design()</code>:</strong></p>
<ol type="1">
<li>If <code>X0=None</code>: Generate space-filling design using Latin Hypercube Sampling (LHS)</li>
<li>If <code>x0</code> (starting point) provided: Include it as first point and transform user’s points to internal scale</li>
<li>Apply dimension reduction if configured</li>
<li>Round integer/factor variables</li>
</ol>
<div id="28cd2525" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>X0 <span class="op">=</span> opt.get_initial_design(X0<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Generated </span><span class="sc">{</span><span class="bu">len</span>(X0)<span class="sc">}</span><span class="ss"> initial design points using Latin Hypercube Sampling"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Design shape: </span><span class="sc">{</span>X0<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First 3 points (internal scale):"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X0[:<span class="dv">3</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generated 10 initial design points using Latin Hypercube Sampling
Design shape: (10, 2)

First 3 points (internal scale):
[[-1.10958242  0.45478229]
 [ 1.65656083  0.228921  ]
 [-1.63767094  0.55620747]]</code></pre>
</div>
</div>
<p>Note, because <code>bounds</code> were set to <code>[(-2, 2), (-2, 2)]</code> and <code>n_initial=10</code>, the generated points are within this range and the design has two-dimensional shape (10, 2).</p>
<ul>
<li>Print initial design in original scale and in internal scale:</li>
</ul>
<div id="ec7de4c5" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>X0_original <span class="op">=</span> opt._inverse_transform_X(X0)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First 3 points (original scale):"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X0_original[:<span class="dv">3</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">First 3 points (internal scale):"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X0[:<span class="dv">3</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
First 3 points (original scale):
[[-1.10958242  1.57583027]
 [ 1.65656083  1.25724272]
 [-1.63767094  1.7440456 ]]

First 3 points (internal scale):
[[-1.10958242  0.45478229]
 [ 1.65656083  0.228921  ]
 [-1.63767094  0.55620747]]</code></pre>
</div>
</div>
<ul>
<li>Plot initial design in original scale:</li>
</ul>
<div id="5485a03d" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(X0_original[:, <span class="dv">0</span>], X0_original[:, <span class="dv">1</span>], c<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Initial Design Points'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"X1"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"X2"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Initial Design Points (Original Scale)"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spot_step_by_step_files/figure-html/cell-9-output-1.png" width="514" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="phase-3-initial-design-curation" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="phase-3-initial-design-curation"><span class="header-section-number">14.3</span> Phase 3: Initial Design Curation</h2>
<section id="method-_curate_initial_design" class="level3" data-number="14.3.1">
<h3 data-number="14.3.1" class="anchored" data-anchor-id="method-_curate_initial_design"><span class="header-section-number">14.3.1</span> Method: <code>_curate_initial_design()</code></h3>
<p>This method ensures we have sufficient unique points and handles repeats.</p>
<p><strong>What happens in <code>_curate_initial_design()</code>:</strong></p>
<ol type="1">
<li>Remove duplicate points (can occur after rounding integers)</li>
<li>Generate additional points if duplicates reduced count below <code>n_initial</code></li>
<li>Repeat each point <code>repeats_initial</code> times if &gt; 1 (for noisy functions)</li>
</ol>
<div id="67c3fb84" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>X0_curated <span class="op">=</span> opt._curate_initial_design(X0)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Curated design shape: </span><span class="sc">{</span>X0_curated<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Unique points: </span><span class="sc">{</span><span class="bu">len</span>(np.unique(X0_curated, axis<span class="op">=</span><span class="dv">0</span>))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total points (with repeats): </span><span class="sc">{</span><span class="bu">len</span>(X0_curated)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Curated design shape: (10, 2)
Unique points: 10
Total points (with repeats): 10</code></pre>
</div>
</div>
</section>
</section>
<section id="phase-4-initial-design-evaluation" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="phase-4-initial-design-evaluation"><span class="header-section-number">14.4</span> Phase 4: Initial Design Evaluation</h2>
<section id="method-_evaluate_function" class="level3" data-number="14.4.1">
<h3 data-number="14.4.1" class="anchored" data-anchor-id="method-_evaluate_function"><span class="header-section-number">14.4.1</span> Method: <code>_evaluate_function()</code></h3>
<p>Evaluates the objective function at all initial design points. The points are converted back to the original scale for evaluation.</p>
<p><strong>What happens in <code>_evaluate_function()</code>:</strong></p>
<ol type="1">
<li>Convert points from internal to original scale</li>
<li>Call objective function with batch of points</li>
<li>Convert multi-objective to single-objective if needed</li>
<li>Return array of function values</li>
</ol>
<div id="1f77cff7" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>X0_original <span class="op">=</span> opt._inverse_transform_X(X0_curated)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>y0 <span class="op">=</span> opt._evaluate_function(X0_curated)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Evaluated </span><span class="sc">{</span><span class="bu">len</span>(y0)<span class="sc">}</span><span class="ss"> points"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Function values shape: </span><span class="sc">{</span>y0<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First 5 points with function values:"</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">min</span>(<span class="dv">5</span>, <span class="bu">len</span>(y0))):</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Point </span><span class="sc">{</span>i<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>X0_original[i]<span class="sc">}</span><span class="ss"> → f(x)=</span><span class="sc">{</span>y0[i]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Best initial value: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">min</span>(y0)<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Worst initial value: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(y0)<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean initial value: </span><span class="sc">{</span>np<span class="sc">.</span>mean(y0)<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Evaluated 10 points
Function values shape: (10,)
First 5 points with function values:
  Point 1: [-1.10958242  1.57583027] → f(x)=16.329192
  Point 2: [1.65656083 1.25724272] → f(x)=221.533421
  Point 3: [-1.63767094  1.7440456 ] → f(x)=94.926795
  Point 4: [1.29554412 1.1658592 ] → f(x)=26.360696
  Point 5: [-0.05124545  1.93852778] → f(x)=375.876648

Best initial value: 16.329192
Worst initial value: 375.876648
Mean initial value: 107.571208</code></pre>
</div>
</div>
</section>
</section>
<section id="phase-5-handling-failed-evaluations" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="phase-5-handling-failed-evaluations"><span class="header-section-number">14.5</span> Phase 5: Handling Failed Evaluations</h2>
<section id="method-_handle_na_initial_designx0y0" class="level3" data-number="14.5.1">
<h3 data-number="14.5.1" class="anchored" data-anchor-id="method-_handle_na_initial_designx0y0"><span class="header-section-number">14.5.1</span> Method: <code>_handle_NA_initial_design(X0,y0)</code></h3>
<p>Removes points that returned NaN or inf values. In contrasts to later phases, no penalties are applied here; invalid points of the initial design are simply removed.</p>
<p><strong>What happens in <code>_handle_NA_initial_design()</code>:</strong></p>
<ol type="1">
<li>Identify NaN/inf values in function evaluations</li>
<li>Remove corresponding design points</li>
<li>Return cleaned arrays and original count</li>
<li>Note: No penalties applied in initial design - invalid points simply removed</li>
</ol>
<div id="6c957769" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>n_before <span class="op">=</span> <span class="bu">len</span>(y0)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>X0_clean, y0_clean, n_evaluated <span class="op">=</span> opt._handle_NA_initial_design(X0_curated, y0)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Points before filtering: </span><span class="sc">{</span>n_before<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Points after filtering: </span><span class="sc">{</span><span class="bu">len</span>(y0_clean)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Removed: </span><span class="sc">{</span>n_before <span class="op">-</span> <span class="bu">len</span>(y0_clean)<span class="sc">}</span><span class="ss"> NaN/inf values"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">All remaining values finite: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">all</span>(np.isfinite(y0_clean))<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Points before filtering: 10
Points after filtering: 10
Removed: 0 NaN/inf values

All remaining values finite: True</code></pre>
</div>
</div>
</section>
</section>
<section id="phase-6-validation-check" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="phase-6-validation-check"><span class="header-section-number">14.6</span> Phase 6: Validation Check</h2>
<section id="method-_check_size_initial_designy0-n_evaluated" class="level3" data-number="14.6.1">
<h3 data-number="14.6.1" class="anchored" data-anchor-id="method-_check_size_initial_designy0-n_evaluated"><span class="header-section-number">14.6.1</span> Method: <code>_check_size_initial_design(y0, n_evaluated)</code></h3>
<p>Ensures we have enough valid points to continue. The minimum required is the smaller of:</p>
<ul>
<li>typical minimum for surrogate fitting (3 for multi-dimensional, 2 for 1D), or</li>
<li>what the user requested (n_initial).</li>
</ul>
<p><strong>What happens in <code>_check_size_initial_design()</code>:</strong></p>
<ol type="1">
<li>Check if at least 1 valid point exists</li>
<li>Raise error if all initial evaluations failed</li>
<li>Print warnings if many points were invalid</li>
</ol>
<div id="21f68cb4" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    opt._check_size_initial_design(y0_clean, n_evaluated)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Validation passed: </span><span class="sc">{</span><span class="bu">len</span>(y0_clean)<span class="sc">}</span><span class="ss"> valid points available"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Minimum required: 1 point"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Original evaluated: </span><span class="sc">{</span>n_evaluated<span class="sc">}</span><span class="ss"> points"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✗ Validation failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Validation passed: 10 valid points available
  Minimum required: 1 point
  Original evaluated: 10 points</code></pre>
</div>
</div>
</section>
</section>
<section id="phase-7-storage-initialization" class="level2" data-number="14.7">
<h2 data-number="14.7" class="anchored" data-anchor-id="phase-7-storage-initialization"><span class="header-section-number">14.7</span> Phase 7: Storage Initialization</h2>
<section id="method-_init_storage" class="level3" data-number="14.7.1">
<h3 data-number="14.7.1" class="anchored" data-anchor-id="method-_init_storage"><span class="header-section-number">14.7.1</span> Method: <code>_init_storage()</code></h3>
<p>Store evaluated points and initialize tracking variables.</p>
<p><strong>What happens during storage initialization:</strong></p>
<ol type="1">
<li><code>_init_storage()</code>: Initialize statistics tracking variables.</li>
</ol>
<ul>
<li>Initialize storage (as done in <code>optimize()</code>)</li>
</ul>
<div id="bd3f8a2e" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize storage and statistics using the new _init_storage() method</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>opt._init_storage(X0_clean, y0_clean)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"X_ (evaluated points): shape </span><span class="sc">{</span>opt<span class="sc">.</span>X_<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_ (function values): shape </span><span class="sc">{</span>opt<span class="sc">.</span>y_<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"n_iter_ (iterations): </span><span class="sc">{</span>opt<span class="sc">.</span>n_iter_<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>X_ (evaluated points): shape (10, 2)
y_ (function values): shape (10,)
n_iter_ (iterations): 0</code></pre>
</div>
</div>
</section>
</section>
<section id="phase-statistics-update" class="level2" data-number="14.8">
<h2 data-number="14.8" class="anchored" data-anchor-id="phase-statistics-update"><span class="header-section-number">14.8</span> Phase: Statistics Update</h2>
<section id="method-update_stats" class="level3" data-number="14.8.1">
<h3 data-number="14.8.1" class="anchored" data-anchor-id="method-update_stats"><span class="header-section-number">14.8.1</span> Method: <code>update_stats()</code></h3>
<p>Update statistics like means and variances for noisy evaluations.</p>
<p>*** What happens in <code>update_stats()</code>:***</p>
<ol type="1">
<li>If <code>noise</code> is set (i.e., <code>repeats_initial</code> &gt; 1):
<ul>
<li>Compute mean and variance of function values for each unique point</li>
<li>Store in <code>mean_X</code>, <code>mean_y</code>, and <code>var_y</code></li>
</ul></li>
</ol>
<div id="9af7e4c0" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Statistics updated:"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> opt.noise:</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - mean_X: </span><span class="sc">{</span>opt<span class="sc">.</span>mean_X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - mean_y: </span><span class="sc">{</span>opt<span class="sc">.</span>mean_y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - var_y: </span><span class="sc">{</span>opt<span class="sc">.</span>var_y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  - No noise tracking (repeats=1)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Statistics updated:
  - No noise tracking (repeats=1)</code></pre>
</div>
</div>
</section>
</section>
<section id="phase-log-initial-design-to-tensorboard" class="level2" data-number="14.9">
<h2 data-number="14.9" class="anchored" data-anchor-id="phase-log-initial-design-to-tensorboard"><span class="header-section-number">14.9</span> Phase: Log initial Design to TensorBoard</h2>
<section id="method-_log_initial_design_tensorboard" class="level3" data-number="14.9.1">
<h3 data-number="14.9.1" class="anchored" data-anchor-id="method-_log_initial_design_tensorboard"><span class="header-section-number">14.9.1</span> Method: <code>_log_initial_design_tensorboard()</code></h3>
<p>This method logs the initial design points and their evaluations to TensorBoard for visualization.</p>
</section>
</section>
<section id="phase-initial-best-point" class="level2" data-number="14.10">
<h2 data-number="14.10" class="anchored" data-anchor-id="phase-initial-best-point"><span class="header-section-number">14.10</span> Phase: Initial Best Point</h2>
<section id="method-_get_best_xy_initial_design" class="level3" data-number="14.10.1">
<h3 data-number="14.10.1" class="anchored" data-anchor-id="method-_get_best_xy_initial_design"><span class="header-section-number">14.10.1</span> Method: <code>_get_best_xy_initial_design()</code></h3>
<p>Identify and report the best point from initial design.</p>
<p><strong>What happens in <code>_get_best_xy_initial_design()</code>:</strong></p>
<ol type="1">
<li>Find minimum value in <code>y_</code> (or <code>mean_y</code> if noise)</li>
<li>Store as <code>best_y_</code></li>
<li>Store corresponding point as <code>best_x_</code></li>
<li>Print progress if verbose</li>
</ol>
<div id="091e9f36" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>opt._get_best_xy_initial_design()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best point found: </span><span class="sc">{</span>opt<span class="sc">.</span>best_x_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best value found: </span><span class="sc">{</span>opt<span class="sc">.</span>best_y_<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Optimum location: [1, 1]"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Optimum value: 0"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Current gap: </span><span class="sc">{</span>opt<span class="sc">.</span>best_y_ <span class="op">-</span> <span class="dv">0</span><span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initial best: f(x) = 16.329192
Best point found: [-1.10958242  1.57583027]
Best value found: 16.329192

Optimum location: [1, 1]
Optimum value: 0
Current gap: 16.329192</code></pre>
</div>
</div>
</section>
</section>
<section id="illustration-of-the-initial-design-phase-results" class="level2" data-number="14.11">
<h2 data-number="14.11" class="anchored" data-anchor-id="illustration-of-the-initial-design-phase-results"><span class="header-section-number">14.11</span> Illustration of the Initial Design Phase Results</h2>
<p>To visualize the results, we generate a contour plot with contour lines of the objective function and mark the best point. The other evaluated points are shown as well:</p>
<div id="699467b3" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grid of points for contour plotting</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">400</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">400</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>X, Y <span class="op">=</span> np.meshgrid(x, y)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>grid_points <span class="op">=</span> np.column_stack([X.ravel(), Y.ravel()])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> rosenbrock(grid_points).reshape(X.shape)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Contour plot</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>contour <span class="op">=</span> plt.contour(X, Y, Z, levels<span class="op">=</span>np.logspace(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">3.5</span>, <span class="dv">20</span>), cmap<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.clabel(contour, inline<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot evaluated points from the initial design phase:</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.scatter(opt.X_[:, <span class="dv">0</span>], opt.X_[:, <span class="dv">1</span>], c<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Evaluated Points'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark best point</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plt.scatter(opt.best_x_[<span class="dv">0</span>], opt.best_x_[<span class="dv">1</span>], c<span class="op">=</span><span class="st">'red'</span>, s<span class="op">=</span><span class="dv">100</span>, label<span class="op">=</span><span class="st">'Best Point'</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'X1'</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'X2'</span>)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Objective Function Contours with Evaluated Points'</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spot_step_by_step_files/figure-html/cell-17-output-1.png" width="685" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sequential-optimization-loop" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Sequential Optimization Loop</h1>
<p>After initialization, the main optimization loop begins. Each iteration follows these steps:</p>
<section id="step-surrogate-model-fitting" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="step-surrogate-model-fitting"><span class="header-section-number">15.1</span> Step: Surrogate Model Fitting</h2>
<section id="method-_fit_scheduler" class="level3" data-number="15.1.1">
<h3 data-number="15.1.1" class="anchored" data-anchor-id="method-_fit_scheduler"><span class="header-section-number">15.1.1</span> Method: <code>_fit_scheduler()</code></h3>
<p>Fit surrogate model using appropriate data based on noise handling.</p>
<p>*** What happens in <code>_fit_scheduler()</code>:***</p>
<p>First, the method transforms the input data <code>X</code> to the internal scale used by the optimizer. Then, it decides which data to use for fitting the surrogate model based on whether noise handling is enabled:</p>
<ol type="1">
<li>If <code>noise</code> is set (i.e., <code>repeats_surrogate</code> &gt; 1):
<ul>
<li>Fit surrogate using mean points (<code>mean_X</code>, <code>mean_y</code>)</li>
</ul></li>
<li>Else:
<ul>
<li>Fit surrogate using all evaluated points (<code>X_</code>, <code>y_</code>)</li>
</ul></li>
</ol>
<p><code>_fit_scheduler()</code> then calls <code>_fit_surrogate()</code> with the selected data.</p>
</section>
<section id="method-_fit_surrogate" class="level3" data-number="15.1.2">
<h3 data-number="15.1.2" class="anchored" data-anchor-id="method-_fit_surrogate"><span class="header-section-number">15.1.2</span> Method: <code>_fit_surrogate()</code></h3>
<p>Fit a surrogate model (Gaussian Process) to current data.</p>
<p><strong>What happens in <code>_fit_surrogate()</code>:</strong></p>
<ol type="1">
<li>If <code>max_surrogate_points</code> set and exceeded: Select subset of points using the <code>_selection_dispatcher()</code> method.</li>
<li>Fit surrogate model using <code>surrogate.fit(X, y)</code></li>
<li>Surrogate learns the function landscape and uncertainty</li>
</ol>
<div id="dd968c18" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>X_for_surrogate <span class="op">=</span> opt._transform_X(opt.X_)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>opt._fit_surrogate(X_for_surrogate, opt.y_)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Surrogate fitted with </span><span class="sc">{</span><span class="bu">len</span>(opt.y_)<span class="sc">}</span><span class="ss"> points"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Surrogate type: </span><span class="sc">{</span><span class="bu">type</span>(opt.surrogate)<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Kernel: </span><span class="sc">{</span>opt<span class="sc">.</span>surrogate<span class="sc">.</span>kernel_<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Surrogate fitted with 10 points
Surrogate type: GaussianProcessRegressor
Kernel: 1.06**2 * Matern(length_scale=0.355, nu=2.5)</code></pre>
</div>
</div>
</section>
<section id="method-_selection_dispatcher" class="level3" data-number="15.1.3">
<h3 data-number="15.1.3" class="anchored" data-anchor-id="method-_selection_dispatcher"><span class="header-section-number">15.1.3</span> Method: <code>_selection_dispatcher()</code></h3>
<p><strong>What happens in <code>_selection_dispatcher()</code>:</strong></p>
<ol type="1">
<li>If <code>max_surrogate_points</code> is set and exceeded:
<ul>
<li>Select a subset of points from <code>X_</code> and <code>y_</code> for fitting the surrogate model.</li>
<li>Strategies may include random sampling, clustering, or other heuristics to reduce the dataset size while preserving important information.</li>
</ul></li>
</ol>
<p><strong>Surrogate Model Selection:</strong></p>
<ul>
<li><p>Default: Gaussian Process with Matérn kernel</p></li>
<li><p>Provides: Mean prediction <span class="math inline">\(\mu(x)\)</span> and uncertainty <span class="math inline">\(\sigma(x)\)</span></p></li>
<li><p>Can be replaced with Random Forest, Kriging, etc.</p></li>
<li><p>The fitted surrogate can be plotted with the following code:</p></li>
</ul>
<div id="d9c056b4" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>opt.plot_surrogate()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="spot_step_by_step_files/figure-html/cell-19-output-1.png" width="1121" height="950" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-apply-ocba" class="level3" data-number="15.1.4">
<h3 data-number="15.1.4" class="anchored" data-anchor-id="step-apply-ocba"><span class="header-section-number">15.1.4</span> Step: Apply OCBA</h3>
</section>
<section id="method-_apply_ocba" class="level3" data-number="15.1.5">
<h3 data-number="15.1.5" class="anchored" data-anchor-id="method-_apply_ocba"><span class="header-section-number">15.1.5</span> Method: <code>_apply_ocba()</code></h3>
<p><strong>What happens in <code>_apply_ocba()</code>:</strong></p>
<ol type="1">
<li>Compute the optimality criteria for each point in the design space.</li>
<li>Select the most promising points based on the criteria.</li>
<li>Update the surrogate model with the selected points.</li>
</ol>
<div id="9097a349" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>X_ocba <span class="op">=</span> opt._apply_ocba()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> X_ocba <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"OCBA selected </span><span class="sc">{</span>X_ocba<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> points for re-evaluation"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"OCBA points shape: </span><span class="sc">{</span>X_ocba<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"OCBA not applied (noise=False or ocba_delta=0)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OCBA not applied (noise=False or ocba_delta=0)</code></pre>
</div>
</div>
</section>
</section>
<section id="step-predict-with-uncertainty" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="step-predict-with-uncertainty"><span class="header-section-number">15.2</span> Step: Predict with Uncertainty</h2>
<section id="method-_predict_with_uncertainty" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="method-_predict_with_uncertainty"><span class="header-section-number">15.2.1</span> Method: <code>_predict_with_uncertainty()</code></h3>
<p>Make predictions at new locations with uncertainty estimates.</p>
<p><strong>What happens in <code>_predict_with_uncertainty()</code>:</strong></p>
<ol type="1">
<li>Call <code>surrogate.predict(X, return_std=True)</code></li>
<li>Returns mean μ(x) and standard deviation σ(x)</li>
<li>Used by acquisition function to balance exploitation (low μ) and exploration (high σ)</li>
</ol>
<p>Here we test prediction at a few points:</p>
<div id="9f4c7811" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> np.array([[<span class="fl">0.5</span>, <span class="fl">0.5</span>], [<span class="fl">1.0</span>, <span class="fl">1.0</span>], [<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>]])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>mu, sigma <span class="op">=</span> opt._predict_with_uncertainty(X_test)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Test points: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Predictions (μ ± σ):"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (x, m, s) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(X_test, mu, sigma)):</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  x=</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> → μ=</span><span class="sc">{</span>m<span class="sc">:.4f}</span><span class="ss">, σ=</span><span class="sc">{</span>s<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test points: (3, 2)

Predictions (μ ± σ):
  x=[0.5 0.5] → μ=135.9904, σ=96.1193
  x=[1. 1.] → μ=97.6979, σ=104.5930
  x=[-0.5  0.5] → μ=169.1890, σ=64.4389</code></pre>
</div>
</div>
</section>
</section>
<section id="step-next-point-suggestion" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="step-next-point-suggestion"><span class="header-section-number">15.3</span> Step: Next Point Suggestion</h2>
<section id="method-_suggest_next_point" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="method-_suggest_next_point"><span class="header-section-number">15.3.1</span> Method: <code>_suggest_next_point()</code></h3>
<p>Optimize acquisition function to find next evaluation point.</p>
<p><strong>What happens in <code>_suggest_next_point()</code>:</strong></p>
<ol type="1">
<li>Use <code>differential_evolution</code> to optimize acquisition function</li>
<li>Find point that maximizes EI (or minimizes predicted value for ‘y’)</li>
<li>Apply rounding for integer/factor variables</li>
<li>Check distance to existing points (avoid duplicates)</li>
<li>If duplicate or too close: Use fallback strategy</li>
<li>Return suggested point</li>
</ol>
<div id="ce6d3d72" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>x_next <span class="op">=</span> opt._suggest_next_point()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Next point suggested: </span><span class="sc">{</span>x_next<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Next point suggested: [1.13866324 0.15750508]</code></pre>
</div>
</div>
<p>Predict at suggested point:</p>
<div id="fef052f2" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mu_next, sigma_next <span class="op">=</span> opt._predict_with_uncertainty(x_next.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Prediction at suggested point:"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  μ(x_next) = </span><span class="sc">{</span>mu_next[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  σ(x_next) = </span><span class="sc">{</span>sigma_next[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Prediction at suggested point:
  μ(x_next) = 1.3255
  σ(x_next) = 50.4602</code></pre>
</div>
</div>
<p><strong>Fallback Strategies</strong> (if acquisition optimization fails):</p>
<ul>
<li><code>'best'</code>: Re-evaluate current best point</li>
<li><code>'mean'</code>: Select point with best predicted mean</li>
<li><code>'random'</code>: Random point in search space</li>
</ul>
</section>
</section>
<section id="step-acquisition-function-evaluation" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="step-acquisition-function-evaluation"><span class="header-section-number">15.4</span> Step: Acquisition Function Evaluation</h2>
<section id="method-_acquisition_function" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1" class="anchored" data-anchor-id="method-_acquisition_function"><span class="header-section-number">15.4.1</span> Method: <code>_acquisition_function()</code></h3>
<p>Compute acquisition function value to guide search. The acquisition function is used as an objective function by the optimizer on the surrogate, e.g., differential evolution. It determines where to sample next.</p>
<div id="01ccf957" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate acquisition at test points</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Acquisition type: </span><span class="sc">{</span>opt<span class="sc">.</span>acquisition<span class="sc">}</span><span class="ss"> (Expected Improvement)"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Acquisition values at test points:"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> X_test:</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    acq_val <span class="op">=</span> opt._acquisition_function(x)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  x=</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> → acq=</span><span class="sc">{</span>acq_val<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Acquisition type: y (Expected Improvement)

Acquisition values at test points:
  x=[0.5 0.5] → acq=135.990446
  x=[1. 1.] → acq=97.697886
  x=[-0.5  0.5] → acq=169.189001</code></pre>
</div>
</div>
<p>Acquisition function can be used to balance:</p>
<ul>
<li>exploitation, i.e., low predicted mean <span class="math inline">\(\mu(x)\)</span> and</li>
<li>exploration, i.e., high uncertainty <span class="math inline">\(\sigma(x)\)</span></li>
</ul>
<p><strong>Acquisition Functions Available:</strong></p>
<ol type="1">
<li><p><strong>Expected Improvement (EI)</strong> - Default, best balance <span class="math display">\[
\text{EI}(x) = (f^* - \mu(x))\Phi(Z) + \sigma(x)\phi(Z)
\]</span> where <span class="math inline">\(Z = \frac{f^* - \mu(x)}{\sigma(x)}\)</span></p></li>
<li><p><strong>Probability of Improvement (PI)</strong> - More exploitative <span class="math display">\[
\text{PI}(x) = \Phi\left(\frac{f^* - \mu(x)}{\sigma(x)}\right)
\]</span></p></li>
<li><p><strong>Mean (‘y’)</strong> - Pure exploitation <span class="math display">\[
\text{acq}(x) = \mu(x)
\]</span></p></li>
</ol>
</section>
</section>
<section id="step-update-repeats-for-infill-points" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="step-update-repeats-for-infill-points"><span class="header-section-number">15.5</span> Step: Update Repeats for Infill Points</h2>
<section id="method-_update_repeats_infill_points" class="level3" data-number="15.5.1">
<h3 data-number="15.5.1" class="anchored" data-anchor-id="method-_update_repeats_infill_points"><span class="header-section-number">15.5.1</span> Method: <code>_update_repeats_infill_points()</code></h3>
<p>Repeat the infill point for noisy function evaluation if <code>repeats_surrogate &gt; 1</code>.</p>
<p><strong>What happens in <code>_update_repeats_infill_points()</code>:</strong></p>
<ol type="1">
<li>Takes the suggested next point (<code>x_next</code>)</li>
<li>If <code>repeats_surrogate &gt; 1</code>: Creates multiple copies for repeated evaluation</li>
<li>Otherwise: Returns point as 2D array (shape: 1 × n_features)</li>
<li>Returns array ready for function evaluation</li>
</ol>
<div id="0a146956" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>x_next_repeated <span class="op">=</span> opt._update_repeats_infill_points(x_next)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Shape before repeating: </span><span class="sc">{</span>x_next<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Shape after repeating: </span><span class="sc">{</span>x_next_repeated<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of evaluations planned: </span><span class="sc">{</span>x_next_repeated<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Shape before repeating: (2,)
Shape after repeating: (1, 2)
Number of evaluations planned: 1</code></pre>
</div>
</div>
</section>
</section>
<section id="append-ocba-points-to-infill-points" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="append-ocba-points-to-infill-points"><span class="header-section-number">15.6</span> Append OCBA Points to Infill Points</h2>
<p>Combines OCBA selected points with the next suggested point for evaluation.</p>
<div id="f54194b1" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> X_ocba <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    x_next_repeated <span class="op">=</span> np.append(X_ocba, x_next_repeated, axis<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-evaluation-of-new-points" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="step-evaluation-of-new-points"><span class="header-section-number">15.7</span> Step: Evaluation of New Points</h2>
<section id="method-_evaluate_function-again" class="level3" data-number="15.7.1">
<h3 data-number="15.7.1" class="anchored" data-anchor-id="method-_evaluate_function-again"><span class="header-section-number">15.7.1</span> Method: <code>_evaluate_function()</code> (again)</h3>
<p>Evaluate the objective function at the suggested points.</p>
<div id="8597923b" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>x_next_2d <span class="op">=</span> x_next.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>y_next <span class="op">=</span> opt._evaluate_function(x_next_2d)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Evaluated point: </span><span class="sc">{</span>x_next<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Function value: </span><span class="sc">{</span>y_next[<span class="dv">0</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Current best: </span><span class="sc">{</span>opt<span class="sc">.</span>best_y_<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Evaluated point: [1.13866324 0.15750508]
Function value: 1.606003
Current best: 16.329192</code></pre>
</div>
</div>
</section>
</section>
<section id="step-handle-failed-evaluations-sequential" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="step-handle-failed-evaluations-sequential"><span class="header-section-number">15.8</span> Step: Handle Failed Evaluations (Sequential)</h2>
<section id="method-_handle_na_new_points" class="level3" data-number="15.8.1">
<h3 data-number="15.8.1" class="anchored" data-anchor-id="method-_handle_na_new_points"><span class="header-section-number">15.8.1</span> Method: <code>_handle_NA_new_points()</code></h3>
<p>Handle NaN/inf values in new evaluations with penalty approach.</p>
<p><strong>What happens in <code>_handle_NA_new_points()</code>:</strong></p>
<ol type="1">
<li><strong>Apply penalty</strong> to NaN/inf values (unlike initial design)
<ul>
<li>Penalty = max(history) + 3×std(history) + random noise</li>
</ul></li>
<li><strong>Remove</strong> remaining invalid values after penalty</li>
<li><strong>Return None</strong> if all evaluations failed → skip iteration</li>
<li><strong>Continue</strong> if any valid evaluations exist</li>
</ol>
<div id="aa3d2746" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x_clean, y_clean <span class="op">=</span> opt._handle_NA_new_points(x_next_2d, y_next)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> x_clean <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✓ Valid evaluations: </span><span class="sc">{</span><span class="bu">len</span>(y_clean)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  All values finite: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">all</span>(np.isfinite(y_clean))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"✗ All evaluations failed - iteration would be skipped"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Valid evaluations: 1
  All values finite: True</code></pre>
</div>
</div>
<p><strong>Why penalties in sequential phase?</strong></p>
<ul>
<li>Preserves optimization history</li>
<li>Allows surrogate to learn “bad” regions</li>
<li>Random noise prevents identical penalties</li>
</ul>
</section>
</section>
<section id="step-update-success-rate" class="level2" data-number="15.9">
<h2 data-number="15.9" class="anchored" data-anchor-id="step-update-success-rate"><span class="header-section-number">15.9</span> Step: Update Success Rate</h2>
<section id="method-_update_success_ratey0" class="level3" data-number="15.9.1">
<h3 data-number="15.9.1" class="anchored" data-anchor-id="method-_update_success_ratey0"><span class="header-section-number">15.9.1</span> Method: <code>_update_success_rate(y0)</code></h3>
<p>Update success rate BEFORE updating storage (initial design - all should be successes since starting from scratch)</p>
<p><strong>What happens in <code>_update_success_rate()</code>:</strong></p>
<ol type="1">
<li>Calculate success rate as ratio of valid evaluations to total evaluated</li>
</ol>
<div id="805f4221" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>opt._update_success_rate(y0_clean)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Success rate updated: </span><span class="sc">{</span>opt<span class="sc">.</span>success_rate<span class="sc">:.2%}</span><span class="ss"> (valid evaluations / total evaluations)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Success rate updated: 0.00% (valid evaluations / total evaluations)</code></pre>
</div>
</div>
</section>
</section>
<section id="step-update-storage" class="level2" data-number="15.10">
<h2 data-number="15.10" class="anchored" data-anchor-id="step-update-storage"><span class="header-section-number">15.10</span> Step: Update Storage</h2>
<section id="internal-updates" class="level3" data-number="15.10.1">
<h3 data-number="15.10.1" class="anchored" data-anchor-id="internal-updates"><span class="header-section-number">15.10.1</span> Internal updates</h3>
<p>Add new evaluations to storage.</p>
<div id="c3a3f720" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>opt._update_storage(x_next_repeated, y_next)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="update-statistics" class="level2" data-number="15.11">
<h2 data-number="15.11" class="anchored" data-anchor-id="update-statistics"><span class="header-section-number">15.11</span> Update Statistics</h2>
<p>Update statistics after new evaluations.</p>
<section id="what-happens-in-update_stats" class="level3" data-number="15.11.1">
<h3 data-number="15.11.1" class="anchored" data-anchor-id="what-happens-in-update_stats"><span class="header-section-number">15.11.1</span> What happens in <code>update_stats()</code>:</h3>
<p><strong>Always updated:</strong></p>
<ul>
<li><code>min_y</code>: Best (minimum) function value</li>
<li><code>min_X</code>: Design point with best value</li>
<li><code>counter</code>: Total number of evaluations</li>
</ul>
<p><strong>For noisy functions only (if <code>noise=True</code>):</strong></p>
<ul>
<li><code>mean_X</code>: Unique design points</li>
<li><code>mean_y</code>: Mean values per design point</li>
<li><code>var_y</code>: Variance per design point</li>
</ul>
<div id="43c20aef" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>opt.update_stats()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Basic statistics:"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  min_y: </span><span class="sc">{</span>opt<span class="sc">.</span>min_y<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  min_X: </span><span class="sc">{</span>opt<span class="sc">.</span>min_X<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  counter: </span><span class="sc">{</span>opt<span class="sc">.</span>counter<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> opt.noise:</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Noise statistics:"</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  mean_X shape: </span><span class="sc">{</span>opt<span class="sc">.</span>mean_X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  mean_y shape: </span><span class="sc">{</span>opt<span class="sc">.</span>mean_y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  var_y shape: </span><span class="sc">{</span>opt<span class="sc">.</span>var_y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Noise handling: disabled (deterministic function)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Basic statistics:
  min_y: 1.606003
  min_X: [1.13866324 1.1705867 ]
  counter: 11

Noise handling: disabled (deterministic function)</code></pre>
</div>
</div>
</section>
</section>
<section id="step-update-best-solution" class="level2" data-number="15.12">
<h2 data-number="15.12" class="anchored" data-anchor-id="step-update-best-solution"><span class="header-section-number">15.12</span> Step: Update Best Solution</h2>
<section id="method-_update_best_main_loop" class="level3" data-number="15.12.1">
<h3 data-number="15.12.1" class="anchored" data-anchor-id="method-_update_best_main_loop"><span class="header-section-number">15.12.1</span> Method: <code>_update_best_main_loop()</code></h3>
<p>Update the best solution if improvement found.</p>
<div id="3dccea18" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>best_before <span class="op">=</span> opt.best_y_</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>opt._update_best_main_loop(x_clean, y_clean)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best before: </span><span class="sc">{</span>best_before<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best after: </span><span class="sc">{</span>opt<span class="sc">.</span>best_y_<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> opt.best_y_ <span class="op">&lt;</span> best_before:</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">✓ New best found!"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Location: </span><span class="sc">{</span>opt<span class="sc">.</span>best_x_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Value: </span><span class="sc">{</span>opt<span class="sc">.</span>best_y_<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">○ Best unchanged"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration 0: New best f(x) = 1.606003
Best before: 16.329192
Best after: 1.606003

✓ New best found!
  Location: [1.13866324 1.1705867 ]
  Value: 1.606003</code></pre>
</div>
</div>
<p><strong>Loop Termination Conditions:</strong></p>
<p>The optimization continues until:</p>
<ol type="1">
<li><code>len(y_) &gt;= max_iter</code> (reached evaluation budget), OR</li>
<li><code>elapsed_time &gt;= max_time</code> (reached time limit)</li>
</ol>
</section>
</section>
</section>
<section id="complete-optimization-example" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Complete Optimization Example</h1>
<p>Now let’s run a complete optimization to see all steps in action:</p>
<div id="9f7865d6" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create fresh optimizer</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>opt_complete <span class="op">=</span> SpotOptim(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">25</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    acquisition<span class="op">=</span><span class="st">'ei'</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,  <span class="co"># Set to False for cleaner output</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Run optimization</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> opt_complete.optimize()</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Optimization Result:"</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'='</span><span class="op">*</span><span class="dv">70</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best point found: </span><span class="sc">{</span>result<span class="sc">.</span>x<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best value: </span><span class="sc">{</span>result<span class="sc">.</span>fun<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True optimum: [1.0, 1.0]"</span>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True minimum: 0.0"</span>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Gap to optimum: </span><span class="sc">{</span>result<span class="sc">.</span>fun<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Function evaluations: </span><span class="sc">{</span>result<span class="sc">.</span>nfev<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sequential iterations: </span><span class="sc">{</span>result<span class="sc">.</span>nit<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Success: </span><span class="sc">{</span>result<span class="sc">.</span>success<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Message: </span><span class="sc">{</span>result<span class="sc">.</span>message<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Optimization Result:
======================================================================
Best point found: [1.08776853 1.15560806]
Best value: 0.084058
True optimum: [1.0, 1.0]
True minimum: 0.0
Gap to optimum: 0.084058

Function evaluations: 25
Sequential iterations: 17
Success: True
Message: Optimization terminated: maximum evaluations (25) reached</code></pre>
</div>
</div>
</section>
<section id="noisy-functions-with-repeats" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> Noisy Functions with Repeats</h1>
<p>When dealing with noisy objective functions, SpotOptim can evaluate each point multiple times and track statistics.</p>
<section id="configuration-for-noisy-functions" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="configuration-for-noisy-functions"><span class="header-section-number">17.1</span> Configuration for Noisy Functions</h2>
<div id="316871ed" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>NOISE_STD <span class="op">=</span> <span class="fl">10.0</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NOISY FUNCTION OPTIMIZATION"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Configuration for noisy optimization with noise std = </span><span class="sc">{</span>NOISE_STD<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrapper to add noise</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rosenbrock_noisy_wrapper(X):</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> rosenbrock_noisy(X, noise_std<span class="op">=</span>NOISE_STD)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>opt_noisy <span class="op">=</span> SpotOptim(</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock_noisy_wrapper,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    repeats_initial<span class="op">=</span><span class="dv">3</span>,      <span class="co"># Evaluate each initial point 3 times</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    repeats_surrogate<span class="op">=</span><span class="dv">2</span>,    <span class="co"># Evaluate each sequential point 2 times</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Configuration for noisy optimization:"</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  repeats_initial: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>repeats_initial<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  repeats_surrogate: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>repeats_surrogate<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  noise: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>noise<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
NOISY FUNCTION OPTIMIZATION
======================================================================

Configuration for noisy optimization with noise std = 10.0:
Configuration for noisy optimization:
  repeats_initial: 3
  repeats_surrogate: 2
  noise: True</code></pre>
</div>
</div>
</section>
<section id="noisy-optimization-workflow-differences" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="noisy-optimization-workflow-differences"><span class="header-section-number">17.2</span> Noisy Optimization Workflow Differences</h2>
<section id="modified-initial-design" class="level3" data-number="17.2.1">
<h3 data-number="17.2.1" class="anchored" data-anchor-id="modified-initial-design"><span class="header-section-number">17.2.1</span> Modified Initial Design</h3>
<p>With <code>repeats_initial &gt; 1</code>:</p>
<div id="e73b40c1" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>result_noisy <span class="op">=</span> opt_noisy.optimize()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Initial design with repeats:"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  n_initial = </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>n_initial<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  repeats_initial = </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>repeats_initial<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total initial evaluations: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>n_initial <span class="op">*</span> opt_noisy<span class="sc">.</span>repeats_initial<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Statistics tracked:"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  mean_X shape: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>mean_X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (unique points)"</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  mean_y shape: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>mean_y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (mean values)"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  var_y shape: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>var_y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss"> (variances)"</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Example statistics for first point:"</span>)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Point: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>mean_X[idx]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean value: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>mean_y[idx]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Variance: </span><span class="sc">{</span>opt_noisy<span class="sc">.</span>var_y[idx]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Std dev: </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(opt_noisy.var_y[idx])<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Initial design with repeats:
  n_initial = 6
  repeats_initial = 3
  Total initial evaluations: 18

Statistics tracked:
  mean_X shape: (7, 2) (unique points)
  mean_y shape: (7,) (mean values)
  var_y shape: (7,) (variances)

Example statistics for first point:
  Point: [-1.90573195 -1.79824535]
  Mean value: 2960.5138
  Variance: 68.6148
  Std dev: 8.2834</code></pre>
</div>
</div>
<p><strong>Key Differences with Noise:</strong></p>
<ol type="1">
<li><strong>Repeated Evaluations</strong>: Each point evaluated multiple times</li>
<li><strong>Statistics Tracking</strong>:
<ul>
<li><code>mean_X</code>: Unique evaluation locations</li>
<li><code>mean_y</code>: Mean function values at each location</li>
<li><code>var_y</code>: Variance of function values</li>
<li><code>n_eval</code>: Number of evaluations per location</li>
</ul></li>
<li><strong>Surrogate Fitting</strong>: Uses <code>mean_y</code> instead of <code>y_</code></li>
<li><strong>Best Selection</strong>: Based on <code>mean_y</code> not individual <code>y_</code></li>
</ol>
</section>
<section id="update-statistics-method" class="level3" data-number="17.2.2">
<h3 data-number="17.2.2" class="anchored" data-anchor-id="update-statistics-method"><span class="header-section-number">17.2.2</span> Update Statistics Method</h3>
<div id="158ff2b0" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"After optimization:"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total evaluations: </span><span class="sc">{</span><span class="bu">len</span>(opt_noisy.y_)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Unique points: </span><span class="sc">{</span><span class="bu">len</span>(opt_noisy.mean_X)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Average repeats per point: </span><span class="sc">{</span><span class="bu">len</span>(opt_noisy.y_) <span class="op">/</span> <span class="bu">len</span>(opt_noisy.mean_X)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Variance statistics:"</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean variance: </span><span class="sc">{</span>np<span class="sc">.</span>mean(opt_noisy.var_y)<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Max variance: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(opt_noisy.var_y)<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Min variance: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">min</span>(opt_noisy.var_y)<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>After optimization:
  Total evaluations: 20
  Unique points: 7
  Average repeats per point: 2.86

Variance statistics:
  Mean variance: 43.630970
  Max variance: 94.990756
  Min variance: 6.357449</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="optimal-computing-budget-allocation-ocba" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Optimal Computing Budget Allocation (OCBA)</h1>
<p>OCBA intelligently allocates additional evaluations to distinguish between competing solutions.</p>
<section id="ocba-configuration" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="ocba-configuration"><span class="header-section-number">18.1</span> OCBA Configuration</h2>
<div id="96298cf6" class="cell" data-execution_count="36">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"OPTIMAL COMPUTING BUDGET ALLOCATION (OCBA)"</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>opt_ocba <span class="op">=</span> SpotOptim(</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock_noisy_wrapper,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    repeats_initial<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    repeats_surrogate<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    ocba_delta<span class="op">=</span><span class="dv">3</span>,           <span class="co"># Allocate 3 additional evaluations per iteration</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"OCBA Configuration:"</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  ocba_delta: </span><span class="sc">{</span>opt_ocba<span class="sc">.</span>ocba_delta<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Purpose: Intelligently re-evaluate existing points"</span>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Benefit: Better distinguish between similar solutions"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
OPTIMAL COMPUTING BUDGET ALLOCATION (OCBA)
======================================================================
OCBA Configuration:
  ocba_delta: 3
  Purpose: Intelligently re-evaluate existing points
  Benefit: Better distinguish between similar solutions</code></pre>
</div>
</div>
</section>
<section id="ocba-method" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="ocba-method"><span class="header-section-number">18.2</span> OCBA Method</h2>
<section id="method-_apply_ocba-1" class="level3" data-number="18.2.1">
<h3 data-number="18.2.1" class="anchored" data-anchor-id="method-_apply_ocba-1"><span class="header-section-number">18.2.1</span> Method: <code>_apply_ocba()</code></h3>
<div id="c51c7db7" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>result_ocba <span class="op">=</span> opt_ocba.optimize()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">OCBA applied during optimization"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Final total evaluations: </span><span class="sc">{</span>result_ocba<span class="sc">.</span>nfev<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Expected without OCBA: ~</span><span class="sc">{</span>opt_ocba<span class="sc">.</span>n_initial <span class="op">*</span> opt_ocba<span class="sc">.</span>repeats_initial <span class="op">+</span> result_ocba<span class="sc">.</span>nit <span class="op">*</span> opt_ocba<span class="sc">.</span>repeats_surrogate<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Additional OCBA evaluations: ~</span><span class="sc">{</span>result_ocba<span class="sc">.</span>nit <span class="op">*</span> opt_ocba<span class="sc">.</span>ocba_delta<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">OCBA intelligently allocated extra evaluations to:"</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Current best candidate (confirm it's truly best)"</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - Close competitors (distinguish between similar solutions)"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  - High-variance points (reduce uncertainty)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
OCBA applied during optimization
  Final total evaluations: 30
  Expected without OCBA: ~27
  Additional OCBA evaluations: ~33

OCBA intelligently allocated extra evaluations to:
  - Current best candidate (confirm it's truly best)
  - Close competitors (distinguish between similar solutions)
  - High-variance points (reduce uncertainty)</code></pre>
</div>
</div>
<p><strong>OCBA Algorithm:</strong></p>
<ol type="1">
<li>Identify best solution (lowest mean value)</li>
<li>Calculate allocation ratios based on:
<ul>
<li>Distance to best solution</li>
<li>Variance of each solution</li>
</ul></li>
<li>Allocate <code>ocba_delta</code> additional evaluations</li>
<li>Returns points to re-evaluate</li>
<li>Requires: ≥3 points with variance &gt; 0</li>
</ol>
<p><strong>OCBA Activation Conditions:</strong> - <code>noise = True</code> (repeats &gt; 1) - <code>ocba_delta &gt; 0</code> - At least 3 design points exist - All points have variance &gt; 0</p>
</section>
</section>
</section>
<section id="handling-function-evaluation-failures" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> Handling Function Evaluation Failures</h1>
<p>SpotOptim robustly handles functions that occasionally fail (return NaN/inf).</p>
<section id="example-with-failures" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="example-with-failures"><span class="header-section-number">19.1</span> Example with Failures</h2>
<div id="c51f9c27" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>opt_failures <span class="op">=</span> SpotOptim(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock_with_failures,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">35</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">42</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>result_failures <span class="op">=</span> opt_failures.optimize()</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Optimization with ~15% random failure rate:"</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Function evaluations: </span><span class="sc">{</span>result_failures<span class="sc">.</span>nfev<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Sequential iterations: </span><span class="sc">{</span>result_failures<span class="sc">.</span>nit<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Success: </span><span class="sc">{</span>result_failures<span class="sc">.</span>success<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Count how many values are non-finite in raw evaluations</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>n_total <span class="op">=</span> <span class="bu">len</span>(opt_failures.y_)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>n_finite <span class="op">=</span> np.<span class="bu">sum</span>(np.isfinite(opt_failures.y_))</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Evaluation statistics:"</span>)</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total evaluations: </span><span class="sc">{</span>n_total<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Finite values: </span><span class="sc">{</span>n_finite<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Note: Failed evaluations handled transparently"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Optimization with ~15% random failure rate:
  Function evaluations: 35
  Sequential iterations: 27
  Success: True

Evaluation statistics:
  Total evaluations: 35
  Finite values: 35
  Note: Failed evaluations handled transparently</code></pre>
</div>
</div>
</section>
<section id="failure-handling-in-initial-design" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="failure-handling-in-initial-design"><span class="header-section-number">19.2</span> Failure Handling in Initial Design</h2>
<section id="method-_handle_na_initial_design" class="level3" data-number="19.2.1">
<h3 data-number="19.2.1" class="anchored" data-anchor-id="method-_handle_na_initial_design"><span class="header-section-number">19.2.1</span> Method: <code>_handle_NA_initial_design()</code></h3>
<div id="e1801d22" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Initial design failure handling:"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  1. Identify NaN/inf values"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  2. Remove invalid points entirely"</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  3. Continue with valid points only"</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  4. No penalties applied"</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  5. Require at least 1 valid point"</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Rationale:"</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Initial design should be clean"</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Invalid regions identified naturally"</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Surrogate trained on good data only"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Initial design failure handling:
  1. Identify NaN/inf values
  2. Remove invalid points entirely
  3. Continue with valid points only
  4. No penalties applied
  5. Require at least 1 valid point

Rationale:
  - Initial design should be clean
  - Invalid regions identified naturally
  - Surrogate trained on good data only</code></pre>
</div>
</div>
</section>
</section>
<section id="failure-handling-in-sequential-phase" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="failure-handling-in-sequential-phase"><span class="header-section-number">19.3</span> Failure Handling in Sequential Phase</h2>
<section id="method-_handle_na_new_points-1" class="level3" data-number="19.3.1">
<h3 data-number="19.3.1" class="anchored" data-anchor-id="method-_handle_na_new_points-1"><span class="header-section-number">19.3.1</span> Method: <code>_handle_NA_new_points()</code></h3>
<div id="2f345ea9" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sequential phase failure handling:"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  1. Apply penalty to NaN/inf values"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     - Penalty = max(history) + 3×std(history)"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"     - Add random noise to avoid duplicates"</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  2. Remove remaining invalid values"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  3. Skip iteration if all evaluations failed"</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  4. Continue if any valid evaluations"</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Penalty approach benefits:"</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  ✓ Preserves optimization history"</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  ✓ Surrogate learns to avoid bad regions"</span>)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  ✓ Better exploration-exploitation balance"</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  ✓ More robust convergence"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sequential phase failure handling:
  1. Apply penalty to NaN/inf values
     - Penalty = max(history) + 3×std(history)
     - Add random noise to avoid duplicates
  2. Remove remaining invalid values
  3. Skip iteration if all evaluations failed
  4. Continue if any valid evaluations

Penalty approach benefits:
  ✓ Preserves optimization history
  ✓ Surrogate learns to avoid bad regions
  ✓ Better exploration-exploitation balance
  ✓ More robust convergence</code></pre>
</div>
</div>
</section>
</section>
<section id="penalty-application" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="penalty-application"><span class="header-section-number">19.4</span> Penalty Application</h2>
<section id="method-_apply_penalty_na" class="level3" data-number="19.4.1">
<h3 data-number="19.4.1" class="anchored" data-anchor-id="method-_apply_penalty_na"><span class="header-section-number">19.4.1</span> Method: <code>_apply_penalty_NA()</code></h3>
<p>Let’s demonstrate penalty calculation:</p>
<div id="2e2cb968" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate historical values</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>y_history_sim <span class="op">=</span> np.array([<span class="fl">10.0</span>, <span class="fl">15.0</span>, <span class="fl">8.0</span>, <span class="fl">12.0</span>, <span class="fl">20.0</span>, <span class="fl">9.0</span>])</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>y_new_sim <span class="op">=</span> np.array([<span class="fl">7.0</span>, np.nan, <span class="fl">11.0</span>, np.inf])</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Historical values:"</span>, y_history_sim)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"New evaluations:"</span>, y_new_sim)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply penalty</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>y_repaired <span class="op">=</span> opt_failures._apply_penalty_NA(</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    y_new_sim, </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    y_history<span class="op">=</span>y_history_sim,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    penalty_value<span class="op">=</span><span class="va">None</span>,  <span class="co"># Compute adaptively</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    sd<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">After penalty application:"</span>, y_repaired)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"All finite: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">all</span>(np.isfinite(y_repaired))<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Show penalty calculation</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>max_hist <span class="op">=</span> np.<span class="bu">max</span>(y_history_sim)</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>std_hist <span class="op">=</span> np.std(y_history_sim, ddof<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>penalty_base <span class="op">=</span> max_hist <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> std_hist</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Penalty calculation:"</span>)</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  max(history) = </span><span class="sc">{</span>max_hist<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  std(history) = </span><span class="sc">{</span>std_hist<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Base penalty = </span><span class="sc">{</span>max_hist<span class="sc">:.2f}</span><span class="ss"> + 3×</span><span class="sc">{</span>std_hist<span class="sc">:.2f}</span><span class="ss"> = </span><span class="sc">{</span>penalty_base<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Actual penalty = </span><span class="sc">{</span>penalty_base<span class="sc">:.2f}</span><span class="ss"> + noise"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Historical values: [10. 15.  8. 12. 20.  9.]
New evaluations: [ 7. nan 11. inf]

After penalty application: [ 7.         33.62137308 11.         33.5370057 ]
All finite: True

Penalty calculation:
  max(history) = 20.00
  std(history) = 4.50
  Base penalty = 20.00 + 3×4.50 = 33.51
  Actual penalty = 33.51 + noise</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="complete-method-summary" class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Complete Method Summary</h1>
<section id="methods-called-during-optimize" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="methods-called-during-optimize"><span class="header-section-number">20.1</span> Methods Called During <code>optimize()</code></h2>
<section id="preparation-phase" class="level3" data-number="20.1.1">
<h3 data-number="20.1.1" class="anchored" data-anchor-id="preparation-phase"><span class="header-section-number">20.1.1</span> Preparation Phase</h3>
<ol type="1">
<li><code>get_initial_design()</code> - Generate/process initial sample points</li>
<li><code>_curate_initial_design()</code> - Remove duplicates, handle repeats</li>
<li><code>_evaluate_function()</code> - Evaluate objective function</li>
<li><code>_handle_NA_initial_design()</code> - Remove NaN/inf from initial design</li>
<li><code>_check_size_initial_design()</code> - Validate sufficient points</li>
<li><code>_init_storage()</code> - Initialize storage (X_, y_, n_iter_)</li>
<li><code>update_stats()</code> - Compute mean/variance for noisy functions</li>
<li><code>_init_tensorboard()</code> - Log initial design to TensorBoard (if enabled)</li>
<li><code>_get_best_xy_initial_design()</code> - Identify initial best</li>
</ol>
</section>
<section id="sequential-optimization-loop-each-iteration" class="level3" data-number="20.1.2">
<h3 data-number="20.1.2" class="anchored" data-anchor-id="sequential-optimization-loop-each-iteration"><span class="header-section-number">20.1.2</span> Sequential Optimization Loop (each iteration)</h3>
<ol start="10" type="1">
<li><code>_fit_scheduler()</code> - Select data and fit surrogate based on noise handling
<ul>
<li>Internally calls <code>_transform_X()</code> - Transform to internal scale</li>
<li>Internally calls <code>_fit_surrogate()</code> - Fit Gaussian Process to data</li>
</ul></li>
<li><code>_apply_ocba()</code> - OCBA allocation (if enabled)</li>
<li><code>_suggest_next_point()</code> - Optimize acquisition function
<ul>
<li>Internally calls <code>_acquisition_function()</code></li>
<li>Internally calls <code>_predict_with_uncertainty()</code></li>
</ul></li>
<li><code>_update_repeats_infill_points()</code> - Repeat suggested point for noisy functions</li>
<li><code>_evaluate_function()</code> - Evaluate at suggested point(s)</li>
<li><code>_handle_NA_new_points()</code> - Handle failures with penalties
<ul>
<li>Internally calls <code>_apply_penalty_NA()</code></li>
<li>Internally calls <code>_remove_nan()</code></li>
</ul></li>
<li><code>_update_success_rate()</code> - Update success tracking</li>
<li><code>_update_storage()</code> - Append new evaluations to storage
<ul>
<li>Internally calls <code>_inverse_transform_X()</code> - Convert back to original scale</li>
</ul></li>
<li><code>update_stats()</code> - Update mean/variance statistics</li>
<li><code>_write_tensorboard_hparams()</code> - Log hyperparameters (if enabled)</li>
<li><code>_write_tensorboard_scalars()</code> - Log scalar metrics (if enabled)</li>
<li><code>_update_best_main_loop()</code> - Update best solution</li>
</ol>
</section>
<section id="finalization" class="level3" data-number="20.1.3">
<h3 data-number="20.1.3" class="anchored" data-anchor-id="finalization"><span class="header-section-number">20.1.3</span> Finalization</h3>
<ol start="22" type="1">
<li><code>to_all_dim()</code> - Expand to full dimensions (if dimensionality reduction used)</li>
<li><code>_determine_termination()</code> - Determine termination reason</li>
<li><code>_close_tensorboard_writer()</code> - Close logging (if enabled)</li>
<li><code>_map_to_factor_values()</code> - Convert factors back to strings</li>
<li>Return <code>OptimizeResult</code> object</li>
</ol>
</section>
</section>
<section id="helper-methods-used" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="helper-methods-used"><span class="header-section-number">20.2</span> Helper Methods Used</h2>
<ul>
<li><code>_generate_initial_design()</code> - LHS generation</li>
<li><code>_repair_non_numeric()</code> - Round integer/factor variables</li>
<li><code>_select_new()</code> - Check for duplicate points</li>
<li><code>_handle_acquisition_failure()</code> - Fallback strategies</li>
<li><code>to_red_dim()</code> - Dimension reduction (if enabled)</li>
<li><code>_selection_dispatcher()</code> - Subset selection for large datasets</li>
</ul>
</section>
</section>
<section id="termination-conditions" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Termination Conditions</h1>
<section id="method-_determine_termination" class="level2" data-number="21.1">
<h2 data-number="21.1" class="anchored" data-anchor-id="method-_determine_termination"><span class="header-section-number">21.1</span> Method: <code>_determine_termination()</code></h2>
<div id="5fd07934" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TERMINATION CONDITIONS"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Method: _determine_termination()"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optimization terminates when:"</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  1. len(y_) &gt;= max_iter (evaluation budget exhausted)"</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  2. elapsed_time &gt;= max_time (time limit reached)"</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  3. Whichever comes first"</span>)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Example from previous run:"</span>)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Message: </span><span class="sc">{</span>result_failures<span class="sc">.</span>message<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Evaluations: </span><span class="sc">{</span>result_failures<span class="sc">.</span>nfev<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>opt_failures<span class="sc">.</span>max_iter<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Iterations: </span><span class="sc">{</span>result_failures<span class="sc">.</span>nit<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
TERMINATION CONDITIONS
======================================================================

Method: _determine_termination()
----------------------------------------------------------------------
Optimization terminates when:
  1. len(y_) &gt;= max_iter (evaluation budget exhausted)
  2. elapsed_time &gt;= max_time (time limit reached)
  3. Whichever comes first

Example from previous run:
  Message: Optimization terminated: maximum evaluations (35) reached
  Evaluations: 35/35
  Iterations: 27</code></pre>
</div>
</div>
</section>
</section>
<section id="performance-comparison-on-noisy-functions" class="level1" data-number="22">
<h1 data-number="22"><span class="header-section-number">22</span> Performance Comparison on Noisy Functions</h1>
<p>Let’s compare standard, noisy, and noisy+OCBA optimization:</p>
<div id="356cd4d1" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"PERFORMANCE COMPARISON"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard optimization</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>opt_std <span class="op">=</span> SpotOptim(</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock_noisy_wrapper,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    repeats_initial<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    repeats_surrogate<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">10</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>result_std <span class="op">=</span> opt_std.optimize()</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># With repeats (no OCBA)</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>opt_rep <span class="op">=</span> SpotOptim(</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock_noisy_wrapper,</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    repeats_initial<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    repeats_surrogate<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    ocba_delta<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">10</span></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>result_rep <span class="op">=</span> opt_rep.optimize()</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co"># With repeats + OCBA</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>opt_ocba_comp <span class="op">=</span> SpotOptim(</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>rosenbrock_noisy_wrapper,</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>    bounds<span class="op">=</span>[(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>), (<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)],</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>    n_initial<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>    max_iter<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>    repeats_initial<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>    repeats_surrogate<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>    ocba_delta<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>    seed<span class="op">=</span><span class="dv">10</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>result_ocba_comp <span class="op">=</span> opt_ocba_comp.optimize()</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the found optima with the TRUE (noise-free) Rosenbrock function</span></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a><span class="co"># to get the actual quality of the solutions</span></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TRUE FUNCTION VALUE EVALUATION"</span>)</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Re-evaluating found optima with noise-free Rosenbrock function:"</span>)</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate each solution with the TRUE function (no noise)</span></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>true_val_std <span class="op">=</span> rosenbrock(result_std.x.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a>true_val_rep <span class="op">=</span> rosenbrock(result_rep.x.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a>true_val_ocba <span class="op">=</span> rosenbrock(result_ocba_comp.x.reshape(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Standard (no repeats):"</span>)</span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Found x: </span><span class="sc">{</span>result_std<span class="sc">.</span>x<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Noisy value (from optimization): </span><span class="sc">{</span>result_std<span class="sc">.</span>fun<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  TRUE value (noise-free): </span><span class="sc">{</span>true_val_std<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">With repeats (no OCBA):"</span>)</span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Found x: </span><span class="sc">{</span>result_rep<span class="sc">.</span>x<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Noisy value (from optimization): </span><span class="sc">{</span>result_rep<span class="sc">.</span>fun<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  TRUE value (noise-free): </span><span class="sc">{</span>true_val_rep<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">With repeats + OCBA:"</span>)</span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Found x: </span><span class="sc">{</span>result_ocba_comp<span class="sc">.</span>x<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Noisy value (from optimization): </span><span class="sc">{</span>result_ocba_comp<span class="sc">.</span>fun<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  TRUE value (noise-free): </span><span class="sc">{</span>true_val_ocba<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"PERFORMANCE COMPARISON SUMMARY"</span>)</span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">70</span>)</span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Comparison on noisy Rosenbrock (σ=</span><span class="sc">{</span>NOISE_STD<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Method'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Noisy Value'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'TRUE Value'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Evaluations'</span><span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'-'</span><span class="op">*</span><span class="dv">75</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Standard (no repeats)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_std<span class="sc">.</span>fun<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>true_val_std<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>result_std<span class="sc">.</span>nfev<span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'With repeats (no OCBA)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_rep<span class="sc">.</span>fun<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>true_val_rep<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>result_rep<span class="sc">.</span>nfev<span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'With repeats + OCBA'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_ocba_comp<span class="sc">.</span>fun<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>true_val_ocba<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>result_ocba_comp<span class="sc">.</span>nfev<span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'-'</span><span class="op">*</span><span class="dv">75</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'True optimum'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'0.0'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'0.0'</span><span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Key observations:"</span>)</span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  • Noisy values (from optimization) are misleading due to noise"</span>)</span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  • TRUE values show actual solution quality"</span>)</span>
<span id="cb77-89"><a href="#cb77-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  • Repeats help find better solutions despite noise"</span>)</span>
<span id="cb77-90"><a href="#cb77-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  • OCBA focuses evaluations on distinguishing best solutions"</span>)</span>
<span id="cb77-91"><a href="#cb77-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  • More evaluations generally lead to better TRUE performance"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
PERFORMANCE COMPARISON
======================================================================

======================================================================
TRUE FUNCTION VALUE EVALUATION
======================================================================

Re-evaluating found optima with noise-free Rosenbrock function:
----------------------------------------------------------------------

Standard (no repeats):
  Found x: [-0.02303646 -0.12724366]
  Noisy value (from optimization): -14.055814
  TRUE value (noise-free): 2.679232

With repeats (no OCBA):
  Found x: [-0.18461315  0.02269759]
  Noisy value (from optimization): -12.282442
  TRUE value (noise-free): 1.416269

With repeats + OCBA:
  Found x: [-0.06715147 -0.03562076]
  Noisy value (from optimization): -16.585110
  TRUE value (noise-free): 1.299855

======================================================================
PERFORMANCE COMPARISON SUMMARY
======================================================================

Comparison on noisy Rosenbrock (σ=10.0):
Method                         Noisy Value     TRUE Value      Evaluations    
---------------------------------------------------------------------------
Standard (no repeats)          -14.055814      2.679232        50             
With repeats (no OCBA)         -12.282442      1.416269        50             
With repeats + OCBA            -16.585110      1.299855        50             
---------------------------------------------------------------------------
True optimum                   0.0             0.0            

Key observations:
  • Noisy values (from optimization) are misleading due to noise
  • TRUE values show actual solution quality
  • Repeats help find better solutions despite noise
  • OCBA focuses evaluations on distinguishing best solutions
  • More evaluations generally lead to better TRUE performance</code></pre>
</div>
</div>
</section>
<section id="summary" class="level1" data-number="23">
<h1 data-number="23"><span class="header-section-number">23</span> Summary</h1>
<section id="complete-workflow-diagram" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="complete-workflow-diagram"><span class="header-section-number">23.1</span> Complete Workflow Diagram</h2>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                     SPOTOPTIM WORKFLOW                          │
└─────────────────────────────────────────────────────────────────┘

INITIALIZATION PHASE
  │
  ├─► get_initial_design()
  │     └─► Generate LHS or process user design
  │
  ├─► _curate_initial_design()
  │     └─► Remove duplicates, add repeats
  │
  ├─► _evaluate_function()
  │     └─► Evaluate objective function
  │
  ├─► _handle_NA_initial_design()
  │     └─► Remove NaN/inf points
  │
  ├─► _check_size_initial_design()
  │     └─► Validate sufficient points
  │
  ├─► _init_storage()
  │     └─► Initialize X_, y_, n_iter_
  │
  ├─► update_stats()
  │     └─► Compute mean/variance (if noise)
  │
  ├─► _init_tensorboard() [if enabled]
  │     └─► Log initial design to TensorBoard
  │
  └─► _get_best_xy_initial_design()
        └─► Identify initial best


SEQUENTIAL OPTIMIZATION LOOP (until max_iter or max_time)
  │
  ├─► _fit_scheduler()
  │     ├─► _transform_X() - Transform to internal scale
  │     └─► _fit_surrogate() - Fit GP to current data
  │
  ├─► _apply_ocba() [if enabled]
  │     └─► Allocate additional evaluations
  │
  ├─► _suggest_next_point()
  │     ├─► _acquisition_function()
  │     │     └─► _predict_with_uncertainty()
  │     └─► Optimize to find next point
  │
  ├─► _update_repeats_infill_points()
  │     └─► Repeat point if repeats_surrogate &gt; 1
  │
  ├─► _evaluate_function()
  │     └─► Evaluate at suggested point(s)
  │
  ├─► _handle_NA_new_points()
  │     ├─► _apply_penalty_NA()
  │     └─► _remove_nan()
  │
  ├─► _update_success_rate()
  │     └─► Track evaluation success
  │
  ├─► _update_storage()
  │     └─► Append new evaluations (with scale conversion)
  │
  ├─► update_stats()
  │     └─► Update mean/variance
  │
  ├─► _write_tensorboard_hparams() [if enabled]
  │     └─► Log hyperparameters
  │
  ├─► _write_tensorboard_scalars() [if enabled]
  │     └─► Log scalar metrics
  │
  └─► _update_best_main_loop()
        └─► Update best if improved


FINALIZATION
  │
  ├─► to_all_dim() [if dimensionality reduction used]
  │     └─► Expand to full dimensions
  │
  ├─► _determine_termination()
  │     └─► Set termination message
  │
  ├─► _close_tensorboard_writer() [if enabled]
  │     └─► Close TensorBoard logging
  │
  ├─► _map_to_factor_values() [if factors used]
  │     └─► Convert factors back to strings
  │
  └─► Return OptimizeResult</code></pre>
</section>
<section id="key-concepts" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="key-concepts"><span class="header-section-number">23.2</span> Key Concepts</h2>
<section id="initial-design" class="level3" data-number="23.2.1">
<h3 data-number="23.2.1" class="anchored" data-anchor-id="initial-design"><span class="header-section-number">23.2.1</span> 1. Initial Design</h3>
<ul>
<li><strong>Latin Hypercube Sampling</strong>: Space-filling design for efficient exploration</li>
<li><strong>Curation</strong>: Remove duplicates from integer/factor rounding</li>
<li><strong>Failure Handling</strong>: Remove invalid points, no penalties</li>
</ul>
</section>
<section id="surrogate-model" class="level3" data-number="23.2.2">
<h3 data-number="23.2.2" class="anchored" data-anchor-id="surrogate-model"><span class="header-section-number">23.2.2</span> 2. Surrogate Model</h3>
<ul>
<li><strong>Default</strong>: Gaussian Process with Matérn kernel</li>
<li><strong>Provides</strong>: Mean μ(x) and uncertainty σ(x) predictions</li>
<li><strong>Purpose</strong>: Learn function landscape with limited evaluations</li>
</ul>
</section>
<section id="acquisition-function" class="level3" data-number="23.2.3">
<h3 data-number="23.2.3" class="anchored" data-anchor-id="acquisition-function"><span class="header-section-number">23.2.3</span> 3. Acquisition Function</h3>
<ul>
<li><strong>EI</strong>: Expected Improvement (default) - best balance</li>
<li><strong>PI</strong>: Probability of Improvement - more exploitative</li>
<li><strong>Mean</strong>: Pure exploitation of surrogate predictions</li>
</ul>
</section>
<section id="noise-handling" class="level3" data-number="23.2.4">
<h3 data-number="23.2.4" class="anchored" data-anchor-id="noise-handling"><span class="header-section-number">23.2.4</span> 4. Noise Handling</h3>
<ul>
<li><strong>Repeats</strong>: Evaluate each point multiple times</li>
<li><strong>Statistics</strong>: Track mean and variance</li>
<li><strong>OCBA</strong>: Intelligently allocate additional evaluations</li>
</ul>
</section>
<section id="failure-handling" class="level3" data-number="23.2.5">
<h3 data-number="23.2.5" class="anchored" data-anchor-id="failure-handling"><span class="header-section-number">23.2.5</span> 5. Failure Handling</h3>
<ul>
<li><strong>Initial Phase</strong>: Remove invalid points</li>
<li><strong>Sequential Phase</strong>: Apply adaptive penalties with noise</li>
<li><strong>Robustness</strong>: Continue optimization despite failures</li>
</ul>
</section>
</section>
<section id="best-practices" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="best-practices"><span class="header-section-number">23.3</span> Best Practices</h2>
<ol type="1">
<li><strong>For deterministic functions</strong>:
<ul>
<li>Use default settings (no repeats)</li>
<li>Acquisition = ‘ei’</li>
<li>Focus on n_initial and max_iter</li>
</ul></li>
<li><strong>For noisy functions</strong>:
<ul>
<li>Set repeats_initial ≥ 2</li>
<li>Set repeats_surrogate ≥ 1</li>
<li>Consider OCBA with ocba_delta ≥ 2</li>
</ul></li>
<li><strong>For unreliable functions</strong>:
<ul>
<li>SpotOptim handles failures automatically</li>
<li>No special configuration needed</li>
<li>Penalties guide search away from bad regions</li>
</ul></li>
<li><strong>For expensive functions</strong>:
<ul>
<li>Increase n_initial (better initial model)</li>
<li>Use ‘ei’ acquisition (best sample efficiency)</li>
<li>Consider max_time limit</li>
</ul></li>
</ol>
</section>
<section id="conclusion" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">23.4</span> Conclusion</h2>
<p>SpotOptim provides a robust and flexible framework for surrogate-based optimization with:</p>
<p>✓ Efficient space-filling initial designs (LHS)<br>
✓ Powerful Gaussian Process surrogate models<br>
✓ Smart acquisition functions (EI, PI, Mean)<br>
✓ Automatic noise handling with statistics<br>
✓ Intelligent budget allocation (OCBA)<br>
✓ Robust failure handling<br>
✓ Comprehensive progress tracking</p>
<p>The modular design allows easy customization while maintaining robust defaults for most use cases.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./006_infill.html" class="pagination-link" aria-label="Infill Criteria">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Infill Criteria</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./spotoptim_examples.html" class="pagination-link" aria-label="SpotOptim Internal Methods Examples">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">SpotOptim Internal Methods Examples</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, T. Bartz-Beielstein</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://sequential-parameter-optimization.github.io/Hyperparameter-Tuning-Cookbook/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/bartzbeielstein">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>